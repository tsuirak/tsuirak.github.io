

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#6f7b5b">
  <meta name="description" content="">
  <meta name="author" content="tsuiraku">
  <meta name="keywords" content="">
  
  <title>JVM - tsuiraku</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":100,"cursorChar":"","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"dC2NdQqyqOkPy2Xg2ij7PMS4-gzGzoHsz","app_key":"XMhtIUKKmpfGkgkdObosNu5I","server_url":"https://dc2ndqqy.lc-cn-n1-shared.com"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body><!-- hexo injector body_begin start --><div id="web_bg"></div><!-- hexo injector body_begin end -->
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>tsuiraku</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="JVM">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-08-16 22:57" pubdate>
        2021å¹´8æœˆ16æ—¥ æ™šä¸Š
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.6k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      115
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- LeanCloud ç»Ÿè®¡æ–‡ç« PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">JVM</h1>
            
            <div class="markdown-body">
              <h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>Java Virtual Machineï¼ŒJAVAç¨‹åºçš„<strong>è¿è¡Œç¯å¢ƒ</strong>ï¼ˆJAVAäºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼‰</p>
<h2 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h2><ul>
<li>$\textcolor{OliveGreen}{ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ}$</li>
<li>$\textcolor{OliveGreen}{è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶}$</li>
<li>$\textcolor{OliveGreen}{æ•°ç»„ä¸‹æ ‡è¶Šç•Œæ£€æŸ¥}$</li>
</ul>
<h2 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h2><p>JVM JRE JDKçš„åŒºåˆ«</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<h1 id="å†…å­˜ç»“æ„"><a href="#å†…å­˜ç»“æ„" class="headerlink" title="å†…å­˜ç»“æ„"></a>å†…å­˜ç»“æ„</h1><h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<h3 id="1-ç¨‹åºè®¡æ•°å™¨"><a href="#1-ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="1.ç¨‹åºè®¡æ•°å™¨"></a>1.ç¨‹åºè®¡æ•°å™¨</h3><h4 id="1-1-ä½œç”¨"><a href="#1-1-ä½œç”¨" class="headerlink" title="1.1 ä½œç”¨"></a>1.1 ä½œç”¨</h4><p>$\textcolor{OliveGreen}{ç”¨äºä¿å­˜jvmä¸­ä¸‹ä¸€æ¡æ‰€è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€}$</p>
<h4 id="1-2-ç‰¹ç‚¹"><a href="#1-2-ç‰¹ç‚¹" class="headerlink" title="1.2 ç‰¹ç‚¹"></a>1.2 ç‰¹ç‚¹</h4><ul>
<li>$\textcolor{OliveGreen}{çº¿ç¨‹ç§æœ‰}$<ul>
<li>CPUä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡ï¼Œå½“å½“å‰çº¿ç¨‹çš„æ—¶é—´ç‰‡ä½¿ç”¨å®Œä»¥åï¼ŒCPUå°±ä¼šå»æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­çš„ä»£ç </li>
<li>ç¨‹åºè®¡æ•°å™¨æ˜¯<strong>æ¯ä¸ªçº¿ç¨‹</strong>æ‰€<strong>ç§æœ‰</strong>çš„ï¼Œå½“å¦ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œï¼Œåˆè¿”å›æ¥æ‰§è¡Œå½“å‰çº¿ç¨‹çš„ä»£ç æ—¶ï¼Œé€šè¿‡ç¨‹åºè®¡æ•°å™¨å¯ä»¥çŸ¥é“åº”è¯¥æ‰§è¡Œå“ªä¸€å¥æŒ‡ä»¤</li>
</ul>
</li>
<li>$\textcolor{OliveGreen}{ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º}$</li>
</ul>
<h3 id="2-è™šæ‹Ÿæœºæ ˆ"><a href="#2-è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="2.è™šæ‹Ÿæœºæ ˆ"></a>2.è™šæ‹Ÿæœºæ ˆ</h3><ul>
<li>-Xss</li>
</ul>
<h4 id="2-1-å®šä¹‰"><a href="#2-1-å®šä¹‰" class="headerlink" title="2.1 å®šä¹‰"></a>2.1 å®šä¹‰</h4><ul>
<li>æ¯ä¸ª<strong>çº¿ç¨‹</strong>è¿è¡Œéœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œç§°ä¸º<strong>è™šæ‹Ÿæœºæ ˆ</strong></li>
<li>æ¯ä¸ªæ ˆç”±å¤šä¸ª<strong>æ ˆå¸§</strong>ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜</li>
<li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰<strong>ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§</strong>ï¼Œå¯¹åº”ç€<strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•</strong></li>
</ul>
<h5 id="æ¼”ç¤º"><a href="#æ¼”ç¤º" class="headerlink" title="æ¼”ç¤º"></a>æ¼”ç¤º</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		method1();<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method1</span><span class="hljs-params">()</span> </span>&#123;<br>		method2(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">method2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> c = a + b;<br>		<span class="hljs-keyword">return</span> c;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<p>åœ¨æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸»ç±»ä¸­çš„æ–¹æ³•åœ¨è¿›å…¥è™šæ‹Ÿæœºæ ˆçš„æ—¶å€™ï¼Œç¬¦åˆæ ˆçš„ç‰¹ç‚¹</p>
<h5 id="é—®é¢˜è¾¨æ"><a href="#é—®é¢˜è¾¨æ" class="headerlink" title="é—®é¢˜è¾¨æ"></a>é—®é¢˜è¾¨æ</h5><ul>
<li>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ<ul>
<li><strong>ä¸éœ€è¦</strong>ã€‚å› ä¸ºè™šæ‹Ÿæœºæ ˆä¸­æ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆçš„ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå¯¹åº”çš„æ ˆå¸§å°±ä¼šè¢«å¼¹å‡ºæ ˆã€‚æ‰€ä»¥æ— éœ€é€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶å»å›æ”¶å†…å­˜ã€‚</li>
</ul>
</li>
<li>æ ˆå†…å­˜çš„åˆ†é…è¶Šå¤§è¶Šå¥½å—ï¼Ÿ<ul>
<li>ä¸æ˜¯ã€‚å› ä¸º<strong>ç‰©ç†å†…å­˜æ˜¯ä¸€å®šçš„</strong>ï¼Œæ ˆå†…å­˜è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒæ›´å¤šçš„é€’å½’è°ƒç”¨ï¼Œä½†æ˜¯å¯æ‰§è¡Œçš„çº¿ç¨‹æ•°å°±ä¼šè¶Šå°‘ã€‚</li>
</ul>
</li>
<li>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ<ul>
<li>å¦‚æœæ–¹æ³•å†…<strong>å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„</li>
<li>å¦‚æœå¦‚æœ<strong>å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡</strong>ï¼Œå¹¶<strong>é€ƒç¦»äº†æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
</ul>
</li>
</ul>
<h4 id="2-2-å†…å­˜æº¢å‡º"><a href="#2-2-å†…å­˜æº¢å‡º" class="headerlink" title="2.2 å†…å­˜æº¢å‡º"></a>2.2 å†…å­˜æº¢å‡º</h4><p><code>Java.lang.stackOverflowError</code> æ ˆå†…å­˜æº¢å‡º</p>
<h5 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h5><ul>
<li>$\textcolor{OliveGreen}{è™šæ‹Ÿæœºæ ˆä¸­ï¼Œæ ˆå¸§è¿‡å¤šï¼ˆæ— é™é€’å½’ï¼‰}$</li>
<li>$\textcolor{OliveGreen}{æ¯ä¸ªæ ˆå¸§æ‰€å ç”¨è¿‡å¤§}$</li>
</ul>
<h4 id="2-3-çº¿ç¨‹è¿è¡Œè¯Šæ–­"><a href="#2-3-çº¿ç¨‹è¿è¡Œè¯Šæ–­" class="headerlink" title="2.3 çº¿ç¨‹è¿è¡Œè¯Šæ–­"></a>2.3 çº¿ç¨‹è¿è¡Œè¯Šæ–­</h4><p>CPUå ç”¨è¿‡é«˜</p>
<ul>
<li>Linuxç¯å¢ƒä¸‹è¿è¡ŒæŸäº›ç¨‹åºçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´CPUçš„å ç”¨è¿‡é«˜ï¼Œè¿™æ—¶éœ€è¦å®šä½å ç”¨CPUè¿‡é«˜çš„çº¿ç¨‹<ul>
<li><code>top</code>å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å“ªä¸ª<strong>è¿›ç¨‹</strong>å ç”¨CPUè¿‡é«˜</li>
<li><code>ps H -eo pid, tid, %cpu | grep + è¿›ç¨‹id</code>  é€šè¿‡ <code>ps</code>å‘½ä»¤è¿›ä¸€æ­¥æŸ¥çœ‹æ˜¯å“ªä¸ª<strong>çº¿ç¨‹</strong>å ç”¨CPUè¿‡é«˜</li>
<li><code>jstack + è¿›ç¨‹id</code> é€šè¿‡æŸ¥çœ‹è¿›ç¨‹ä¸­çš„çº¿ç¨‹çš„<code>tid</code>ï¼Œé€šè¿‡<code>ps</code>å‘½ä»¤æŸ¥çœ‹çš„<code>tid</code>æ¥<strong>å¯¹æ¯”å®šä½</strong>ï¼Œæ³¨æ„<code>jstack</code>æŸ¥æ‰¾å‡ºçš„çº¿ç¨‹<code>tid</code>æ˜¯<strong>16è¿›åˆ¶çš„</strong>ï¼Œ<strong>éœ€è¦è½¬æ¢</strong></li>
</ul>
</li>
</ul>
<h3 id="3-æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3-æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3.æœ¬åœ°æ–¹æ³•æ ˆ"></a>3.æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>ä¸€äº›å¸¦æœ‰<code>native</code><strong>å…³é”®å­—</strong>çš„æ–¹æ³•å°±æ˜¯éœ€è¦JAVAå»è°ƒç”¨æœ¬åœ°çš„Cæˆ–è€…C++æ–¹æ³•ï¼Œå› ä¸ºJAVAæœ‰æ—¶å€™æ²¡æ³•ç›´æ¥å’Œæ“ä½œç³»ç»Ÿåº•å±‚äº¤äº’ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°æœ¬åœ°æ–¹æ³•</p>
<h3 id="4-å †"><a href="#4-å †" class="headerlink" title="4.å †"></a>4.å †</h3><ul>
<li>-Xmx</li>
</ul>
<h4 id="4-1-å®šä¹‰"><a href="#4-1-å®šä¹‰" class="headerlink" title="4.1 å®šä¹‰"></a>4.1 å®šä¹‰</h4><p>é€šè¿‡newå…³é”®å­—<strong>åˆ›å»ºçš„å¯¹è±¡</strong>éƒ½ä¼šè¢«æ”¾åœ¨å †å†…å­˜</p>
<h5 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h5><ul>
<li>$\textcolor{OliveGreen}{æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå †å†…å­˜ä¸­çš„å¯¹è±¡éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜}$</li>
<li>$ \textcolor{OliveGreen}{æœ‰åƒåœ¾å›æ”¶æœºåˆ¶}$</li>
</ul>
<h4 id="4-2-å †å†…å­˜æº¢å‡º"><a href="#4-2-å †å†…å­˜æº¢å‡º" class="headerlink" title="4.2 å †å†…å­˜æº¢å‡º"></a>4.2 å †å†…å­˜æº¢å‡º</h4><p><code>java.lang.OutofMemoryError: Java heap space </code> å †å†…å­˜æº¢å‡º</p>
<h4 id="4-3-å †å†…å­˜è¯Šæ–­å·¥å…·"><a href="#4-3-å †å†…å­˜è¯Šæ–­å·¥å…·" class="headerlink" title="4.3 å †å†…å­˜è¯Šæ–­å·¥å…·"></a>4.3 å †å†…å­˜è¯Šæ–­å·¥å…·</h4><ul>
<li><p><code>jps</code></p>
<ul>
<li>æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰å“ªäº›javaè¿›ç¨‹</li>
</ul>
</li>
<li><p><code>jmap</code></p>
<ul>
<li>æŸ¥çœ‹å †å†…å­˜å ç”¨æƒ…å†µï¼ˆæŸä¸€æ—¶åˆ»ï¼‰</li>
</ul>
</li>
<li><p><code>jconsole</code></p>
<ul>
<li>å›¾å½¢åŒ–ç•Œé¢ï¼Œå¤šåŠŸèƒ½çš„ç›‘æµ‹å·¥å…·ï¼Œå¯ä»¥è¿ç»­ç›‘æµ‹</li>
</ul>
</li>
<li><p><code>jvirsalvm</code></p>
</li>
</ul>
<h3 id="5-æ–¹æ³•åŒº"><a href="#5-æ–¹æ³•åŒº" class="headerlink" title="5.æ–¹æ³•åŒº"></a>5.æ–¹æ³•åŒº</h3><h4 id="5-1-ç»“æ„"><a href="#5-1-ç»“æ„" class="headerlink" title="5.1 ç»“æ„"></a>5.1 ç»“æ„</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<h4 id="5-2-å†…å­˜æº¢å‡º"><a href="#5-2-å†…å­˜æº¢å‡º" class="headerlink" title="5.2 å†…å­˜æº¢å‡º"></a>5.2 å†…å­˜æº¢å‡º</h4><ul>
<li>1.8ä»¥å‰ä¼šå¯¼è‡´<strong>æ°¸ä¹…ä»£</strong>å†…å­˜æº¢å‡º <ul>
<li><code>-XX:MaxPermSize=8m</code></li>
<li><code>java.lang.OutOfMemoryError: PermGen space</code></li>
</ul>
</li>
<li>1.8ä»¥åä¼šå¯¼è‡´<strong>å…ƒç©ºé—´</strong>å†…å­˜æº¢å‡º<ul>
<li>å…ƒç©ºé—´ä½¿ç”¨ç³»ç»Ÿå†…å­˜</li>
<li><code> -XX:MaxMetaspaceSize=8m</code></li>
<li><code>java.lang.OutOfMemoryError: Metaspace</code></li>
</ul>
</li>
</ul>
<h4 id="5-3-è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#5-3-è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="5.3 è¿è¡Œæ—¶å¸¸é‡æ± "></a>5.3 è¿è¡Œæ—¶å¸¸é‡æ± </h4><ul>
<li><p>äºŒè¿›åˆ¶å­—èŠ‚ç çš„ç»„æˆ</p>
<ul>
<li>ç±»çš„åŸºæœ¬ä¿¡æ¯</li>
<li>å¸¸é‡æ± </li>
<li>ç±»çš„æ–¹æ³•å®šä¹‰ï¼ˆåŒ…å«äº†è™šæ‹ŸæœºæŒ‡ä»¤ï¼‰</li>
</ul>
</li>
<li><p>é€šè¿‡åç¼–è¯‘æ¥æŸ¥çœ‹ç±»çš„ä¿¡æ¯</p>
<ul>
<li><p>è·å¾—å¯¹åº”ç±»çš„.classæ–‡ä»¶</p>
</li>
<li><p>åœ¨æ§åˆ¶å°è¾“å…¥ javap -v ç±»çš„è·¯å¾„</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">javap -v xxx.<span class="hljs-built_in">class</span><br></code></pre></td></tr></table></figure></li>
<li><p>åœ¨æ§åˆ¶å°çœ‹åˆ°åç¼–è¯‘ä»¥åç±»çš„ä¿¡æ¯äº†</p>
<ul>
<li><p>ç±»çš„åŸºæœ¬ä¿¡æ¯</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
</li>
<li><p>å¸¸é‡æ± </p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
</li>
<li><p>è™šæ‹Ÿæœºä¸­æ‰§è¡Œç¼–è¯‘çš„æ–¹æ³•ï¼ˆæ¡†å†…çš„æ˜¯çœŸæ­£ç¼–è¯‘æ‰§è¡Œçš„å†…å®¹ï¼Œ**#å·çš„å†…å®¹éœ€è¦åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾**ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="å¸¸é‡æ± ä¸è¿è¡Œæ—¶å¸¸é‡æ± çš„åŒºåˆ«"><a href="#å¸¸é‡æ± ä¸è¿è¡Œæ—¶å¸¸é‡æ± çš„åŒºåˆ«" class="headerlink" title="å¸¸é‡æ± ä¸è¿è¡Œæ—¶å¸¸é‡æ± çš„åŒºåˆ«"></a>å¸¸é‡æ± ä¸è¿è¡Œæ—¶å¸¸é‡æ± çš„åŒºåˆ«</h5><ul>
<li>å¸¸é‡æ± <ul>
<li>å°±æ˜¯ä¸€å¼ è¡¨ï¼ˆå¦‚ä¸Šå›¾ä¸­çš„constant poolï¼‰ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ä¿¡æ¯</li>
</ul>
</li>
<li>è¿è¡Œæ—¶å¸¸é‡æ± <ul>
<li>å¸¸é‡æ± æ˜¯*.classæ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥<strong>ç±»è¢«åŠ è½½ä»¥å</strong>ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼š<strong>æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œå¹¶æŠŠé‡Œé¢çš„<strong>ç¬¦å·åœ°å€å˜ä¸ºçœŸå®åœ°å€</strong></li>
</ul>
</li>
</ul>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="5-4-å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"><a href="#5-4-å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»" class="headerlink" title="5.4 å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"></a>5.4 å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»</h4><h4 id="5-5-ä¸²æ± -String-space-Table"><a href="#5-5-ä¸²æ± -String-space-Table" class="headerlink" title="5.5 ä¸²æ±  $String\space Table$"></a>5.5 <strong>ä¸²æ± </strong> $String\space Table$</h4><ul>
<li>ç‰¹å¾<ul>
<li>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œåªæœ‰<strong>åœ¨è¢«ç”¨åˆ°æ—¶æ‰ä¼šè½¬åŒ–ä¸ºå¯¹è±¡</strong></li>
<li>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡</li>
<li>å­—ç¬¦ä¸²<strong>å˜é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯ <strong>StringBuilder</strong></li>
<li>å­—ç¬¦ä¸²<strong>å¸¸é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯<strong>ç¼–è¯‘å™¨ä¼˜åŒ–</strong></li>
<li>å¯ä»¥ä½¿ç”¨<strong>internæ–¹æ³•</strong>ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± ä¸­</li>
<li><strong>æ³¨æ„</strong>ï¼šæ— è®ºæ˜¯ä¸²æ± è¿˜æ˜¯å †é‡Œé¢çš„å­—ç¬¦ä¸²ï¼Œéƒ½æ˜¯å¯¹è±¡</li>
</ul>
</li>
</ul>
<p>ç”¨æ¥æ”¾å­—ç¬¦ä¸²å¯¹è±¡ä¸”é‡Œé¢çš„<strong>å…ƒç´ ä¸é‡å¤</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		String a = <span class="hljs-string">&quot;a&quot;</span>; <br>		String b = <span class="hljs-string">&quot;b&quot;</span>;<br>		String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ï¼Œéƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä½†è¿™æ˜¯a b ab ä»…æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·ï¼Œ<strong>è¿˜æ²¡æœ‰æˆä¸ºjavaå­—ç¬¦ä¸²</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">0:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#2                  // String a</span><br><span class="hljs-attr">2:</span> <span class="hljs-string">astore_1</span><br><span class="hljs-attr">3:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#3                  // String b</span><br><span class="hljs-attr">5:</span> <span class="hljs-string">astore_2</span><br><span class="hljs-attr">6:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#4                  // String ab</span><br><span class="hljs-attr">8:</span> <span class="hljs-string">astore_3</span><br><span class="hljs-attr">9:</span> <span class="hljs-string">returnCopy</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>å½“æ‰§è¡Œåˆ° ldc #2 æ—¶ï¼Œä¼šæŠŠç¬¦å· a å˜ä¸º â€œaâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œ<strong>å¹¶æ”¾å…¥ä¸²æ± ä¸­</strong>ï¼ˆhashtableç»“æ„ ä¸å¯æ‰©å®¹ï¼‰</p>
</li>
<li><p>å½“æ‰§è¡Œåˆ° ldc #3 æ—¶ï¼Œä¼šæŠŠç¬¦å· b å˜ä¸º â€œbâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p>
</li>
<li><p>å½“æ‰§è¡Œåˆ° ldc #4 æ—¶ï¼Œä¼šæŠŠç¬¦å· ab å˜ä¸º â€œabâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p>
</li>
</ul>
<p>æœ€ç»ˆ <strong>StringTable [â€œaâ€, â€œbâ€, â€œabâ€]</strong></p>
<p><strong>æ³¨æ„</strong>ï¼šå­—ç¬¦ä¸²å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯<strong>æ‡’æƒ°çš„</strong>ï¼Œåªæœ‰å½“è¿è¡Œåˆ°é‚£ä¸€è¡Œå­—ç¬¦ä¸²ä¸”åœ¨ä¸²æ± ä¸­ä¸å­˜åœ¨çš„æ—¶å€™ï¼ˆå¦‚ ldc #2ï¼‰æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²æ‰ä¼šè¢«åˆ›å»ºå¹¶æ”¾å…¥ä¸²æ± ä¸­ã€‚</p>
<p>ä½¿ç”¨æ‹¼æ¥<strong>å­—ç¬¦ä¸²å˜é‡å¯¹è±¡</strong>åˆ›å»ºå­—ç¬¦ä¸²çš„è¿‡ç¨‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		String a = <span class="hljs-string">&quot;a&quot;</span>;<br>		String b = <span class="hljs-string">&quot;b&quot;</span>;<br>		String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>		<span class="hljs-comment">// æ‹¼æ¥å­—ç¬¦ä¸²å¯¹è±¡æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²</span><br>		String ab2 = a+b; <br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åç¼–è¯‘åçš„ç»“æœ</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs console">Code:<br>  stack=2, locals=6, args_size=1<br>     0: ldc           #2         // String a<br>     2: astore_1<br>     3: ldc           #3         // String b<br>     5: astore_2<br>     6: ldc           #4         // String ab<br>     8: astore_3<br>     9: new           #5         // class java/lang/StringBuilder<br>    12: dup<br>    13: invokespecial #6         // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V<br>    16: aload_1<br>    17: invokevirtual #7         // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>    20: aload_2<br>    21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>    24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;<br>    27: astore        4<br>    //ab3åˆå§‹åŒ–æ—¶ç›´æ¥ä»ä¸²æ± ä¸­è·å–å­—ç¬¦ä¸²<br>    29: ldc           #4                  // String ab<br>    31: astore        5<br>    33: return<br></code></pre></td></tr></table></figure>

<p>é€šè¿‡æ‹¼æ¥çš„æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²çš„<strong>è¿‡ç¨‹</strong>æ˜¯ï¼š<code>new StringBuilder().append(â€œaâ€).append(â€œbâ€).toString()</code></p>
<p>æœ€åçš„toStringæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª<strong>æ–°çš„å­—ç¬¦ä¸²</strong>ï¼Œä½†å­—ç¬¦ä¸²çš„<strong>å€¼</strong>å’Œæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸€è‡´ï¼Œä½†æ˜¯ä¸¤ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ï¼Œ<strong>ä¸€ä¸ªå­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œä¸€ä¸ªå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>String ab2 = a+b;<br><span class="hljs-comment">//ç»“æœä¸ºfalse,å› ä¸ºabæ˜¯å­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œab2æ˜¯ç”±StringBufferçš„toStringæ–¹æ³•æ‰€è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br>System.out.println(ab == ab2); <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure>



<p>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡å¯¹è±¡</strong>çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		String a = <span class="hljs-string">&quot;a&quot;</span>;<br>		String b = <span class="hljs-string">&quot;b&quot;</span>;<br>		String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>		String ab2 = a+b;<br>		<span class="hljs-comment">//ä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</span><br>		String ab3 = <span class="hljs-string">&quot;a&quot;</span> + <span class="hljs-string">&quot;b&quot;</span>;<br>    <br>    System.out.println(ab == ab3); <span class="hljs-comment">// true</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åç¼–è¯‘åçš„ç»“æœ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Code:</span><br>  <span class="hljs-string">stack=2,</span> <span class="hljs-string">locals=6,</span> <span class="hljs-string">args_size=1</span><br>     <span class="hljs-attr">0:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#2                  // String a</span><br>     <span class="hljs-attr">2:</span> <span class="hljs-string">astore_1</span><br>     <span class="hljs-attr">3:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#3                  // String b</span><br>     <span class="hljs-attr">5:</span> <span class="hljs-string">astore_2</span><br>     <span class="hljs-attr">6:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#4                  // String ab</span><br>     <span class="hljs-attr">8:</span> <span class="hljs-string">astore_3</span><br>     <span class="hljs-attr">9:</span> <span class="hljs-string">new</span>           <span class="hljs-comment">#5                  // class java/lang/StringBuilder</span><br>    <span class="hljs-attr">12:</span> <span class="hljs-string">dup</span><br>    <span class="hljs-attr">13:</span> <span class="hljs-string">invokespecial</span> <span class="hljs-comment">#6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V</span><br>    <span class="hljs-attr">16:</span> <span class="hljs-string">aload_1</span><br>    <span class="hljs-attr">17:</span> <span class="hljs-string">invokevirtual</span> <span class="hljs-comment">#7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span><br>    <span class="hljs-attr">20:</span> <span class="hljs-string">aload_2</span><br>    <span class="hljs-attr">21:</span> <span class="hljs-string">invokevirtual</span> <span class="hljs-comment">#7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span><br>    <span class="hljs-attr">24:</span> <span class="hljs-string">invokevirtual</span> <span class="hljs-comment">#8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span><br>    <span class="hljs-attr">27:</span> <span class="hljs-string">astore</span>        <span class="hljs-number">4</span><br>    <span class="hljs-string">//ab3åˆå§‹åŒ–æ—¶ç›´æ¥ä»ä¸²æ± ä¸­è·å–å­—ç¬¦ä¸²</span><br>    <span class="hljs-attr">29:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#4                  // String ab</span><br>    <span class="hljs-attr">31:</span> <span class="hljs-string">astore</span>        <span class="hljs-number">5</span><br>    <span class="hljs-attr">33:</span> <span class="hljs-string">returnCopy</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸º<strong>å†…å®¹æ˜¯å¸¸é‡ï¼Œjavacåœ¨ç¼–è¯‘æœŸä¼šè¿›è¡Œä¼˜åŒ–ï¼Œç»“æœå·²åœ¨ç¼–è¯‘æœŸç¡®å®šä¸ºab</strong>ï¼Œè€Œåˆ›å»ºabçš„æ—¶å€™å·²ç»åœ¨ä¸²æ± ä¸­æ”¾å…¥äº†â€œabâ€ï¼Œæ‰€ä»¥ab3ç›´æ¥ä»ä¸²æ± ä¸­è·å–å€¼ï¼Œæ‰€ä»¥è¿›è¡Œçš„æ“ä½œå’Œ ab = â€œabâ€ ä¸€è‡´ã€‚</p>
</li>
<li><p>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å˜é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸ºå†…å®¹æ˜¯å˜é‡ï¼Œåªèƒ½<strong>åœ¨è¿è¡ŒæœŸç¡®å®šå®ƒçš„å€¼ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨StringBuilderæ¥åˆ›å»º</strong></p>
</li>
</ul>
<h5 id="internæ–¹æ³•-1-8"><a href="#internæ–¹æ³•-1-8" class="headerlink" title="internæ–¹æ³• 1.8"></a>internæ–¹æ³• 1.8</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p>
<ul>
<li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥æˆåŠŸ</li>
<li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li>
</ul>
<p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p>
<p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶å¦‚æœè°ƒç”¨internæ–¹æ³•æˆåŠŸï¼Œå †å†…å­˜ä¸ä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</p>
<p><strong>ä¾‹1</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-comment">// ä¸²æ± ï¼š&quot;a&quot; &quot;b&quot; </span><br>    <span class="hljs-comment">// å †ï¼šstr new StringBuild.append(&quot;a&quot;).appned(&quot;b&quot;).toStirng()</span><br>    <span class="hljs-comment">// å †ï¼šnew String(&quot;a&quot;) </span><br>    <span class="hljs-comment">// å †ï¼šnew String(&quot;b&quot;) </span><br>		String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);<br>		<br>    <span class="hljs-comment">// è°ƒç”¨strçš„internæ–¹æ³•ï¼Œæ­¤æ—¶ä¸²æ± ä¸­æ²¡æœ‰&quot;ab&quot;ï¼Œåˆ™ä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥åˆ°ä¸²æ± ä¸­ï¼Œæ­¤æ—¶å †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span><br>   	<span class="hljs-comment">// å°†&quot;ab&quot;å¯¹è±¡è¿”å›ç»™str2</span><br>		String str2 = str.intern();<br>		<br>    <span class="hljs-comment">// ç»™str3èµ‹å€¼ï¼Œå› ä¸ºæ­¤æ—¶ä¸²æ± ä¸­å·²æœ‰&quot;ab&quot;ï¼Œåˆ™ç›´æ¥å°†ä¸²æ± ä¸­çš„å†…å®¹è¿”å›</span><br>		String str3 = <span class="hljs-string">&quot;ab&quot;</span>;<br>		<br>    <span class="hljs-comment">// å› ä¸ºå †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä»¥ä¸‹ä¸¤æ¡è¯­å¥æ‰“å°çš„éƒ½ä¸ºtrue</span><br>		System.out.println(str == st2); <span class="hljs-comment">// true</span><br>		System.out.println(str == str3); <span class="hljs-comment">// true</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ä¾‹2</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>    <span class="hljs-comment">// æ­¤å¤„åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡&quot;ab&quot;ï¼Œå› ä¸ºä¸²æ± ä¸­è¿˜æ²¡æœ‰&quot;ab&quot;ï¼Œæ‰€ä»¥å°†å…¶æ”¾å…¥ä¸²æ± ä¸­</span><br>		String str3 = <span class="hljs-string">&quot;ab&quot;</span>;<br>    <br>    <span class="hljs-comment">// ä¸²æ± ï¼š&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­</span><br>    <span class="hljs-comment">// å †ï¼šstr</span><br>		String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);<br>   <br>    <span class="hljs-comment">// æ­¤æ—¶å› ä¸ºåœ¨åˆ›å»ºstr3æ—¶ï¼Œ&quot;ab&quot;å·²å­˜åœ¨ä¸ä¸²æ± ä¸­ï¼Œæ‰€ä»¥æ”¾å…¥å¤±è´¥ï¼Œä½†æ˜¯ä¼šè¿”å›ä¸²æ± ä¸­çš„&quot;ab&quot;</span><br>		String str2 = str.intern();<br>     <br>    <span class="hljs-comment">// å †ä¸­ä¸ä¸²æ± ä¸­&quot;ab&quot;ä¸ä¸€æ ·</span><br>		System.out.println(str == str2);  <span class="hljs-comment">// false</span><br>		System.out.println(str == str3); <span class="hljs-comment">// false</span><br>		System.out.println(str2 == str3);  <span class="hljs-comment">// true</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h5 id="internæ–¹æ³•-1-6"><a href="#internæ–¹æ³•-1-6" class="headerlink" title="internæ–¹æ³• 1.6"></a>internæ–¹æ³• 1.6</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p>
<ul>
<li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡<strong>å¤åˆ¶</strong>ä¸€ä»½ï¼Œå†æ”¾å…¥åˆ°ä¸²æ± ä¸­</li>
<li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li>
</ul>
<p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p>
<p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶æ— è®ºè°ƒç”¨internæ–¹æ³•æˆåŠŸä¸å¦ï¼Œä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡å’Œå †å†…å­˜ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡<strong>éƒ½ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</strong></p>
<p><strong>ä¾‹1</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-comment">// ä¸²æ± ï¼š&quot;a&quot; &quot;b&quot; </span><br>    <span class="hljs-comment">// å †ï¼šstr new StringBuild.append(&quot;a&quot;).appned(&quot;b&quot;).toStirng()</span><br>    <span class="hljs-comment">// å †ï¼šnew String(&quot;a&quot;) </span><br>    <span class="hljs-comment">// å †ï¼šnew String(&quot;b&quot;) </span><br>		String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);<br>		<br>    <span class="hljs-comment">// è°ƒç”¨strçš„internæ–¹æ³•ï¼Œæ­¤æ—¶ä¸²æ± ä¸­æ²¡æœ‰&quot;ab&quot;ï¼Œåˆ™ä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å¤åˆ¶ä¸€ä»½æ”¾å…¥åˆ°ä¸²æ± ä¸­ï¼Œæ­¤æ—¶å †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;ä¸æ˜¯æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span><br>    <span class="hljs-comment">// ä¸²æ± ï¼šstr2</span><br>		String str2 = str.intern();<br>		<br>    <span class="hljs-comment">// ç»™str3èµ‹å€¼ï¼Œå› ä¸ºæ­¤æ—¶ä¸²æ± ä¸­å·²æœ‰&quot;ab&quot;ï¼Œåˆ™ç›´æ¥å°†ä¸²æ± ä¸­çš„å†…å®¹è¿”å›</span><br>    <span class="hljs-comment">// ä¸²æ± ï¼šstr3</span><br>		String str3 = <span class="hljs-string">&quot;ab&quot;</span>;<br>		<br>    <span class="hljs-comment">// å †å†…å­˜å¹¶ä¸æ˜¯ä¸ä¸²æ± &quot;abä¸ºåŒä¸€ä¸ªå¯¹è±¡</span><br>		System.out.println(str == st2); <span class="hljs-comment">// false</span><br>		System.out.println(str == str3); <span class="hljs-comment">// false</span><br>    System.out.println(str2 == str3); <span class="hljs-comment">// true</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ä¾‹2</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>    <span class="hljs-comment">// æ­¤å¤„åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡&quot;ab&quot;ï¼Œå› ä¸ºä¸²æ± ä¸­è¿˜æ²¡æœ‰&quot;ab&quot;ï¼Œæ‰€ä»¥å°†å…¶æ”¾å…¥ä¸²æ± ä¸­</span><br>		String str3 = <span class="hljs-string">&quot;ab&quot;</span>;<br>    <br>    <span class="hljs-comment">// ä¸²æ± ï¼š&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­</span><br>    <span class="hljs-comment">// å †ï¼šstr</span><br>		String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);<br>   <br>    <span class="hljs-comment">// æ­¤æ—¶å› ä¸ºåœ¨åˆ›å»ºstr3æ—¶ï¼Œ&quot;ab&quot;å·²å­˜åœ¨ä¸ä¸²æ± ä¸­ï¼Œæ‰€ä»¥æ”¾å…¥å¤±è´¥ï¼Œè¿”å›ä¸²æ± ä¸­çš„&quot;ab&quot;</span><br>		String str2 = str.intern();<br>     <br>    <span class="hljs-comment">// å †ä¸­ä¸ä¸²æ± ä¸­&quot;ab&quot;ä¸ä¸€æ ·</span><br>		System.out.println(str == str2);  <span class="hljs-comment">// false</span><br>		System.out.println(str == str3); <span class="hljs-comment">// false</span><br>		System.out.println(str2 == str3);  <span class="hljs-comment">// true</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h5 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// jvm1.8</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>    <span class="hljs-comment">// ä¸²æ± ï¼šs1 s2 s3 s5 s6</span><br>    <span class="hljs-comment">// å †ï¼šs4</span><br>		String s1 = <span class="hljs-string">&quot;a&quot;</span>;<br>    String s2 = <span class="hljs-string">&quot;b&quot;</span>;<br>    String s3 = <span class="hljs-string">&quot;a&quot;</span> + <span class="hljs-string">&quot;b&quot;</span>;<br>    String s4 = s1 + s2;<br>    String s5 = <span class="hljs-string">&quot;ab&quot;</span>;<br>    String s6 = s4.intern();<br>    <br>    System.out.println(s3 == s4); <span class="hljs-comment">// false</span><br>    System.out.println(s3 == s5); <span class="hljs-comment">// true</span><br>    System.out.println(s3 == s6); <span class="hljs-comment">// true</span><br>    <br>    <span class="hljs-comment">// ä¸²æ± ï¼š&quot;c&quot; &quot;d&quot; x1=&quot;cd&quot;</span><br>    <span class="hljs-comment">// å †ï¼šx2=&quot;cd&quot;</span><br>    String x2 = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;c&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;d&quot;</span>);<br>    String x1 = <span class="hljs-string">&quot;cd&quot;</span>;<br>    <span class="hljs-comment">// ä¸²æ± ä¸­å·²ç»å­˜åœ¨&quot;cd&quot;ï¼Œæ”¾å…¥å¤±è´¥</span><br>    x2.intern();<br>    <br>    System.out.println(x1 == x2); <span class="hljs-comment">// false</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="5-6-StringTable-ä½ç½®"><a href="#5-6-StringTable-ä½ç½®" class="headerlink" title="5.6 StringTable ä½ç½®"></a>5.6 StringTable ä½ç½®</h4><p><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="5-7-StringTable-åƒåœ¾å›æ”¶"><a href="#5-7-StringTable-åƒåœ¾å›æ”¶" class="headerlink" title="5.7 StringTable åƒåœ¾å›æ”¶"></a>5.7 StringTable åƒåœ¾å›æ”¶</h4><p>StringTableåœ¨å†…å­˜ç´§å¼ æ—¶ï¼Œä¼šå‘ç”Ÿåƒåœ¾å›æ”¶</p>
<h4 id="5-8-StringTable-è°ƒä¼˜"><a href="#5-8-StringTable-è°ƒä¼˜" class="headerlink" title="5.8 StringTable è°ƒä¼˜"></a>5.8 StringTable è°ƒä¼˜</h4><ul>
<li><p>å› ä¸ºStringTableæ˜¯ç”±HashTableå®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥<strong>é€‚å½“å¢åŠ HashTableæ¡¶çš„ä¸ªæ•°</strong>ï¼Œæ¥å‡å°‘å­—ç¬¦ä¸²æ”¾å…¥ä¸²æ± æ‰€éœ€è¦çš„æ—¶é—´</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl">-<span class="hljs-variable">XX</span>:<span class="hljs-variable">StringTableSize</span>=<span class="hljs-function"><span class="hljs-title">xxxx</span>(ğŸª£ä¸ªæ•°)</span><br></code></pre></td></tr></table></figure></li>
<li><p>è€ƒè™‘æ˜¯å¦éœ€è¦å°†å­—ç¬¦ä¸²å¯¹è±¡å…¥æ± </p>
<p>å¯ä»¥é€šè¿‡<strong>internæ–¹æ³•å‡å°‘é‡å¤å…¥æ± </strong></p>
</li>
</ul>
<h3 id="6-ç›´æ¥å†…å­˜"><a href="#6-ç›´æ¥å†…å­˜" class="headerlink" title="6.ç›´æ¥å†…å­˜"></a>6.ç›´æ¥å†…å­˜</h3><ul>
<li>å±äºæ“ä½œç³»ç»Ÿï¼Œå¸¸è§äºNIOæ“ä½œæ—¶ï¼Œ<strong>ç”¨äºæ•°æ®ç¼“å†²åŒº</strong></li>
<li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜</li>
<li>ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç†</li>
</ul>
<h4 id="æ–‡ä»¶è¯»å†™æµç¨‹"><a href="#æ–‡ä»¶è¯»å†™æµç¨‹" class="headerlink" title="æ–‡ä»¶è¯»å†™æµç¨‹"></a>æ–‡ä»¶è¯»å†™æµç¨‹</h4><ul>
<li>IO</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png" srcset="/img/loading.gif" lazyload></a></p>
<ul>
<li>DirectBuffer</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<p>ç›´æ¥å†…å­˜æ˜¯æ“ä½œç³»ç»Ÿå’ŒJavaä»£ç <strong>éƒ½å¯ä»¥è®¿é—®çš„ä¸€å—åŒºåŸŸ</strong>ï¼Œæ— éœ€å°†ä»£ç ä»ç³»ç»Ÿå†…å­˜å¤åˆ¶åˆ°Javaå †å†…å­˜ï¼Œä»è€Œæé«˜äº†æ•ˆç‡</p>
<h4 id="é‡Šæ”¾åŸç†-â“"><a href="#é‡Šæ”¾åŸç†-â“" class="headerlink" title="é‡Šæ”¾åŸç† â“"></a>é‡Šæ”¾åŸç† â“</h4><p>ç›´æ¥å†…å­˜çš„å›æ”¶ä¸æ˜¯é€šè¿‡JVMçš„åƒåœ¾å›æ”¶æ¥é‡Šæ”¾çš„ï¼Œè€Œæ˜¯é€šè¿‡ <code>unsafe.freeMemory</code> æ¥æ‰‹åŠ¨é‡Šæ”¾</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€šè¿‡ByteBufferç”³è¯·1Mçš„ç›´æ¥å†…å­˜</span><br>ByteBuffer byteBuffer = ByteBuffer.allocateDirect(_1M);Copy<br></code></pre></td></tr></table></figure>

<p>ç”³è¯·ç›´æ¥å†…å­˜ï¼Œä½†JVMå¹¶ä¸èƒ½å›æ”¶ç›´æ¥å†…å­˜ä¸­çš„å†…å®¹ï¼Œå®ƒæ˜¯å¦‚ä½•å®ç°å›æ”¶çš„å‘¢ï¼Ÿ</p>
<p>allocateDirectçš„å®ç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteBuffer <span class="hljs-title">allocateDirect</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectByteBuffer(capacity);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>DirectByteBufferç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java">DirectByteBuffer(<span class="hljs-keyword">int</span> cap) &#123;   <span class="hljs-comment">// package-private</span><br>   <br>    <span class="hljs-keyword">super</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, cap, cap);<br>    <span class="hljs-keyword">boolean</span> pa = VM.isDirectMemoryPageAligned();<br>    <span class="hljs-keyword">int</span> ps = Bits.pageSize();<br>    <span class="hljs-keyword">long</span> size = Math.max(<span class="hljs-number">1L</span>, (<span class="hljs-keyword">long</span>)cap + (pa ? ps : <span class="hljs-number">0</span>));<br>    Bits.reserveMemory(size, cap);<br><br>    <span class="hljs-keyword">long</span> base = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        base = unsafe.allocateMemory(size); <span class="hljs-comment">//ç”³è¯·å†…å­˜</span><br>    &#125; <span class="hljs-keyword">catch</span> (OutOfMemoryError x) &#123;<br>        Bits.unreserveMemory(size, cap);<br>        <span class="hljs-keyword">throw</span> x;<br>    &#125;<br>    unsafe.setMemory(base, size, (<span class="hljs-keyword">byte</span>) <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (pa &amp;&amp; (base % ps != <span class="hljs-number">0</span>)) &#123;<br>        <span class="hljs-comment">// Round up to page boundary</span><br>        address = base + ps - (base &amp; (ps - <span class="hljs-number">1</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        address = base;<br>    &#125;<br>    cleaner = Cleaner.create(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> Deallocator(base, size, cap)); <span class="hljs-comment">//é€šè¿‡è™šå¼•ç”¨ï¼Œæ¥å®ç°ç›´æ¥å†…å­˜çš„é‡Šæ”¾ï¼Œthisä¸ºè™šå¼•ç”¨çš„å®é™…å¯¹è±¡</span><br>    att = <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªCleanerçš„createæ–¹æ³•ï¼Œä¸”åå°çº¿ç¨‹è¿˜ä¼šå¯¹è™šå¼•ç”¨çš„å¯¹è±¡ç›‘æµ‹ï¼Œå¦‚æœè™šå¼•ç”¨çš„å®é™…å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯DirectByteBufferï¼‰è¢«å›æ”¶ä»¥åï¼Œå°±ä¼šè°ƒç”¨Cleanerçš„cleanæ–¹æ³•ï¼Œæ¥æ¸…é™¤ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clean</span><span class="hljs-params">()</span> </span>&#123;<br>       <span class="hljs-keyword">if</span> (remove(<span class="hljs-keyword">this</span>)) &#123;<br>           <span class="hljs-keyword">try</span> &#123;<br>               <span class="hljs-keyword">this</span>.thunk.run(); <span class="hljs-comment">//è°ƒç”¨runæ–¹æ³•</span><br>           &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">final</span> Throwable var2) &#123;<br>               AccessController.doPrivileged(<span class="hljs-keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;<br>                   <span class="hljs-function"><span class="hljs-keyword">public</span> Void <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                       <span class="hljs-keyword">if</span> (System.err != <span class="hljs-keyword">null</span>) &#123;<br>                           (<span class="hljs-keyword">new</span> Error(<span class="hljs-string">&quot;Cleaner terminated abnormally&quot;</span>, var2)).printStackTrace();<br>                       &#125;<br><br>                       System.exit(<span class="hljs-number">1</span>);<br>                       <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>                   &#125;<br>               &#125;);<br>           &#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”å¯¹è±¡çš„runæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (address == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// Paranoia</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    unsafe.freeMemory(address); <span class="hljs-comment">//é‡Šæ”¾ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</span><br>    address = <span class="hljs-number">0</span>;<br>    Bits.unreserveMemory(size, capacity);<br>&#125;Copy<br></code></pre></td></tr></table></figure>

<h5 id="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"><a href="#ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“" class="headerlink" title="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"></a>ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“</h5><ul>
<li>ä½¿ç”¨äº†Unsafeç±»æ¥å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶ï¼Œå›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨freeMemoryæ–¹æ³•</li>
<li>ByteBufferçš„å®ç°å†…éƒ¨ä½¿ç”¨äº†Cleanerï¼ˆè™šå¼•ç”¨ï¼‰æ¥æ£€æµ‹ByteBufferã€‚ä¸€æ—¦ByteBufferè¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆä¼šç”±ReferenceHandleræ¥è°ƒç”¨Cleanerçš„cleanæ–¹æ³•è°ƒç”¨freeMemoryæ¥é‡Šæ”¾å†…å­˜</li>
</ul>
<h2 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h2><h3 id="1-å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"><a href="#1-å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶" class="headerlink" title="1.å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"></a>1.å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶</h3><h4 id="1-1-å¼•ç”¨è®¡æ•°æ³•"><a href="#1-1-å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="1.1 å¼•ç”¨è®¡æ•°æ³•"></a>1.1 å¼•ç”¨è®¡æ•°æ³•</h4><p>å¼Šç«¯ï¼šå¾ªç¯å¼•ç”¨æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„è®¡æ•°éƒ½ä¸º1ï¼Œå¯¼è‡´ä¸¤ä¸ªå¯¹è±¡éƒ½æ— æ³•è¢«é‡Šæ”¾</p>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011408931.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h4 id="1-2-å¯è¾¾æ€§åˆ†æç®—æ³•-â“"><a href="#1-2-å¯è¾¾æ€§åˆ†æç®—æ³•-â“" class="headerlink" title="1.2 å¯è¾¾æ€§åˆ†æç®—æ³• â“"></a>1.2 å¯è¾¾æ€§åˆ†æç®—æ³• â“</h4><ul>
<li>JVMä¸­çš„åƒåœ¾å›æ”¶å™¨é€šè¿‡<strong>å¯è¾¾æ€§åˆ†æ</strong>æ¥æ¢ç´¢æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡</li>
<li>æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹èƒ½å¦æ²¿ç€GC Rootå¯¹è±¡ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¦‚æœ<strong>æ‰¾ä¸åˆ°ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å›æ”¶</strong></li>
<li>å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡<ul>
<li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
</li>
</ul>
<h4 id="1-3-5ç§å¼•ç”¨"><a href="#1-3-5ç§å¼•ç”¨" class="headerlink" title="1.3 5ç§å¼•ç”¨"></a>1.3 5ç§å¼•ç”¨</h4><img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011409990.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="1-3-1-å¼ºå¼•ç”¨"><a href="#1-3-1-å¼ºå¼•ç”¨" class="headerlink" title="1.3.1 å¼ºå¼•ç”¨"></a>1.3.1 å¼ºå¼•ç”¨</h5><p>â€‹    åªæœ‰GC Root<strong>éƒ½ä¸å¼•ç”¨</strong>è¯¥å¯¹è±¡æ—¶ï¼Œæ‰ä¼šå›æ”¶<strong>å¼ºå¼•ç”¨</strong>å¯¹è±¡</p>
<p>â€‹    å¦‚ä¸Šå›¾Bã€Cå¯¹è±¡éƒ½ä¸å¼•ç”¨A1å¯¹è±¡æ—¶ï¼ŒA1å¯¹è±¡æ‰ä¼šè¢«å›æ”¶</p>
<h5 id="1-3-2-è½¯å¼•ç”¨"><a href="#1-3-2-è½¯å¼•ç”¨" class="headerlink" title="1.3.2 è½¯å¼•ç”¨"></a>1.3.2 è½¯å¼•ç”¨</h5><p>â€‹    å½“GC RootæŒ‡å‘è½¯å¼•ç”¨å¯¹è±¡æ—¶ï¼Œåœ¨<strong>å†…å­˜ä¸è¶³æ—¶</strong>ï¼Œä¼š<strong>å›æ”¶è½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</strong></p>
<p>â€‹    å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A2å¯¹è±¡ä¸”å†…å­˜ä¸è¶³æ—¶ï¼Œè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„A2å¯¹è±¡å°±ä¼šè¢«å›æ”¶</p>
<p>â€‹    è½¯å¼•ç”¨çš„ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> _4M = <span class="hljs-number">4</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;<br>		<span class="hljs-comment">// ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span><br>		List&lt;SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>		SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt; ref= <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[_4M]);<br>	&#125;<br>&#125;Copy<br></code></pre></td></tr></table></figure>

<p>â€‹    å¦‚æœåœ¨åƒåœ¾å›æ”¶æ—¶å‘ç°å†…å­˜ä¸è¶³ï¼Œåœ¨å›æ”¶è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡æ—¶ï¼Œ<strong>è½¯å¼•ç”¨æœ¬èº«ä¸ä¼šè¢«æ¸…ç†</strong></p>
<p>â€‹    å¦‚æœæƒ³è¦<strong>æ¸…ç†è½¯å¼•ç”¨</strong>ï¼Œéœ€è¦ä½¿<strong>ç”¨å¼•ç”¨é˜Ÿåˆ—</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> _4M = <span class="hljs-number">4</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>;<br>		<span class="hljs-comment">// ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—ï¼Œç”¨äºç§»é™¤å¼•ç”¨ä¸ºç©ºçš„è½¯å¼•ç”¨å¯¹è±¡</span><br>		ReferenceQueue&lt;<span class="hljs-keyword">byte</span>[]&gt; queue = <span class="hljs-keyword">new</span> ReferenceQueue&lt;&gt;();<br>		<span class="hljs-comment">// ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span><br>		List&lt;SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>		SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt; ref= <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[_4M]);<br><br>		<span class="hljs-comment">// éå†å¼•ç”¨é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å…ƒç´ ï¼Œåˆ™ç§»é™¤</span><br>		Reference&lt;? extends <span class="hljs-keyword">byte</span>[]&gt; poll = queue.poll();<br>		<span class="hljs-keyword">while</span>(poll != <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-comment">// å¼•ç”¨é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™ä»é›†åˆä¸­ç§»é™¤è¯¥å…ƒç´ </span><br>			list.remove(poll);<br>			<span class="hljs-comment">//ç§»åŠ¨åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>			po ll = queue.poll();<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>å¤§æ¦‚æ€è·¯ä¸ºï¼š</strong>æŸ¥çœ‹å¼•ç”¨é˜Ÿåˆ—ä¸­æœ‰æ— è½¯å¼•ç”¨ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å°†è¯¥è½¯å¼•ç”¨ä»å­˜æ”¾å®ƒçš„é›†åˆä¸­ç§»é™¤ï¼ˆè¿™é‡Œä¸ºä¸€ä¸ªlisté›†åˆï¼‰</p>
<h5 id="1-3-3-å¼±å¼•ç”¨"><a href="#1-3-3-å¼±å¼•ç”¨" class="headerlink" title="1.3.3 å¼±å¼•ç”¨"></a>1.3.3 å¼±å¼•ç”¨</h5><p>â€‹    åªæœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œ<strong>æ— è®ºå†…å­˜æ˜¯å¦å……è¶³</strong>ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</p>
<p>â€‹    å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A3å¯¹è±¡ï¼Œåˆ™A3å¯¹è±¡ä¼šè¢«å›æ”¶</p>
<p>â€‹    <strong>å¼±å¼•ç”¨çš„ä½¿ç”¨å’Œè½¯å¼•ç”¨ç±»ä¼¼</strong>ï¼Œåªæ˜¯å°† <strong>SoftReference æ¢ä¸ºäº† WeakReference</strong></p>
<h5 id="1-3-4-è™šå¼•ç”¨"><a href="#1-3-4-è™šå¼•ç”¨" class="headerlink" title="1.3.4 è™šå¼•ç”¨"></a>1.3.4 è™šå¼•ç”¨</h5><p>å½“è™šå¼•ç”¨å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œè°ƒç”¨è™šå¼•ç”¨çš„æ–¹æ³•</p>
<ul>
<li>è™šå¼•ç”¨çš„ä¸€ä¸ªä½“ç°æ˜¯<strong>é‡Šæ”¾ç›´æ¥å†…å­˜æ‰€åˆ†é…çš„å†…å­˜</strong>ï¼Œå½“å¼•ç”¨çš„å¯¹è±¡ByteBufferè¢«åƒåœ¾å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡Cleanerå°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨Cleanerçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li>
<li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨ByteBufferå¯¹è±¡ï¼ŒByteBufferå°±ä¼šè¢«å›æ”¶ã€‚ä½†æ˜¯ç›´æ¥å†…å­˜ä¸­çš„å†…å­˜è¿˜æœªè¢«å›æ”¶ã€‚è¿™æ—¶éœ€è¦å°†è™šå¼•ç”¨å¯¹è±¡Cleaneræ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨å®ƒçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li>
</ul>
<h5 id="1-3-5-ç»ˆç»“å™¨å¼•ç”¨"><a href="#1-3-5-ç»ˆç»“å™¨å¼•ç”¨" class="headerlink" title="1.3.5 ç»ˆç»“å™¨å¼•ç”¨"></a>1.3.5 ç»ˆç»“å™¨å¼•ç”¨</h5><p>æ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿è‡ªObjectç±»ï¼ŒObjectç±»æœ‰ä¸€ä¸ªfinalizeæ–¹æ³•ã€‚å½“æŸä¸ªå¯¹è±¡ä¸å†è¢«å…¶ä»–çš„å¯¹è±¡æ‰€å¼•ç”¨æ—¶ï¼Œä¼šå…ˆå°†ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åæ ¹æ®ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</p>
<ul>
<li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨A4å¯¹è±¡ã€‚è¿™æ˜¯ç»ˆç»“å™¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œå¼•ç”¨é˜Ÿåˆ—ä¼šæ ¹æ®å®ƒï¼Œæ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åè°ƒç”¨è¢«å¼•ç”¨å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</li>
</ul>
<h5 id="å¼•ç”¨é˜Ÿåˆ—"><a href="#å¼•ç”¨é˜Ÿåˆ—" class="headerlink" title="å¼•ç”¨é˜Ÿåˆ—"></a>å¼•ç”¨é˜Ÿåˆ—</h5><ul>
<li>è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨<strong>å¯ä»¥é…åˆ</strong>å¼•ç”¨é˜Ÿåˆ—<ul>
<li>åœ¨<strong>å¼±å¼•ç”¨</strong>å’Œ<strong>è™šå¼•ç”¨</strong>æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œä¼šå°†è¿™äº›å¼•ç”¨æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œæ–¹ä¾¿ä¸€èµ·å›æ”¶è¿™äº›è½¯/å¼±å¼•ç”¨å¯¹è±¡</li>
</ul>
</li>
<li>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨<strong>å¿…é¡»é…åˆ</strong>å¼•ç”¨é˜Ÿåˆ—<ul>
<li>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨åœ¨ä½¿ç”¨æ—¶ä¼šå…³è”ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—</li>
</ul>
</li>
</ul>
<h3 id="2-åƒåœ¾å›æ”¶ç®—æ³•"><a href="#2-åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="2.åƒåœ¾å›æ”¶ç®—æ³•"></a>2.åƒåœ¾å›æ”¶ç®—æ³•</h3><h4 id="2-1-æ ‡è®°-æ¸…é™¤"><a href="#2-1-æ ‡è®°-æ¸…é™¤" class="headerlink" title="2.1 æ ‡è®°-æ¸…é™¤"></a>2.1 æ ‡è®°-æ¸…é™¤</h4><img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011411252.png" srcset="/img/loading.gif" lazyload style="zoom:40%;" />

<p><strong>å®šä¹‰</strong>ï¼šæ ‡è®°æ¸…é™¤ç®—æ³•é¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‡åœ¨è™šæ‹Ÿæœºæ‰§è¡Œåƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆé‡‡ç”¨æ ‡è®°ç®—æ³•ç¡®å®šå¯å›æ”¶å¯¹è±¡ï¼Œç„¶ååƒåœ¾æ”¶é›†å™¨æ ¹æ®æ ‡è¯†æ¸…é™¤ç›¸åº”çš„å†…å®¹ï¼Œç»™å †å†…å­˜è…¾å‡ºç›¸åº”çš„ç©ºé—´</p>
<ul>
<li>è¿™é‡Œçš„è…¾å‡ºå†…å­˜ç©ºé—´å¹¶ä¸æ˜¯å°†å†…å­˜ç©ºé—´çš„å­—èŠ‚æ¸…0ï¼Œè€Œæ˜¯è®°å½•ä¸‹è¿™æ®µå†…å­˜çš„èµ·å§‹ç»“æŸåœ°å€ï¼Œä¸‹æ¬¡åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œä¼šç›´æ¥<strong>è¦†ç›–</strong>è¿™æ®µå†…å­˜</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š<strong>å®¹æ˜“äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡</strong>ï¼Œå¯èƒ½æ— æ³•æ»¡è¶³å¤§å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œä¸€æ—¦å¯¼è‡´æ— æ³•åˆ†é…å¯¹è±¡ï¼Œé‚£å°±ä¼šå¯¼è‡´jvmå¯åŠ¨gcï¼Œä¸€æ—¦å¯åŠ¨gcï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±ä¼šæš‚åœï¼Œè¿™å°±å¯¼è‡´åº”ç”¨çš„å“åº”é€Ÿåº¦å˜æ…¢</p>
<h4 id="2-2-æ ‡è®°-æ•´ç†"><a href="#2-2-æ ‡è®°-æ•´ç†" class="headerlink" title="2.2 æ ‡è®°-æ•´ç†"></a>2.2 æ ‡è®°-æ•´ç†</h4><img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011411345.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>æ ‡è®°-æ•´ç† ä¼šå°†ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡å›æ”¶ï¼Œæ¸…æ¥šå…¶å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç„¶åæ•´ç†å‰©ä½™çš„å¯¹è±¡ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å› å†…å­˜ç¢ç‰‡è€Œå¯¼è‡´çš„é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ•´ä½“éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´ï¼Œæ‰€ä»¥æ•ˆç‡è¾ƒä½</p>
<h4 id="2-3-å¤åˆ¶"><a href="#2-3-å¤åˆ¶" class="headerlink" title="2.3 å¤åˆ¶"></a>2.3 å¤åˆ¶</h4><img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011412754.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011414736.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011414861.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011414261.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>å°†å†…å­˜åˆ†ä¸ºç­‰å¤§å°çš„ä¸¤ä¸ªåŒºåŸŸï¼ŒFROMå’ŒTOï¼ˆTOä¸­ä¸ºç©ºï¼‰ã€‚å…ˆå°†è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ä»FROMæ”¾å…¥TOä¸­ï¼Œå†å›æ”¶ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åäº¤æ¢FROMå’ŒTOã€‚è¿™æ ·ä¹Ÿå¯ä»¥é¿å…å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šå ç”¨åŒå€çš„å†…å­˜ç©ºé—´ã€‚</p>
<h3 id="3-åˆ†ä»£å›æ”¶"><a href="#3-åˆ†ä»£å›æ”¶" class="headerlink" title="3.åˆ†ä»£å›æ”¶"></a>3.åˆ†ä»£å›æ”¶</h3><img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011415172.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h4 id="3-1-å›æ”¶æµç¨‹"><a href="#3-1-å›æ”¶æµç¨‹" class="headerlink" title="3.1 å›æ”¶æµç¨‹"></a>3.1 å›æ”¶æµç¨‹</h4><p>æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½è¢«æ”¾åœ¨äº†<strong>æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­</strong>ä¸­</p>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011415076.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>å½“ä¼Šç”¸å›­ä¸­çš„å†…å­˜ä¸è¶³æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œè¿™æ—¶çš„å›æ”¶å«åš <strong>Minor GC</strong></p>
<p>Minor GC ä¼šå°†<strong>ä¼Šç”¸å›­å’Œå¹¸å­˜åŒºFROM</strong>å­˜æ´»çš„å¯¹è±¡<strong>å…ˆ</strong>å¤åˆ¶åˆ° <strong>å¹¸å­˜åŒº TO</strong>ä¸­ï¼Œ å¹¶è®©å…¶<strong>å¯¿å‘½åŠ 1</strong>ï¼Œå†<strong>äº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒº</strong></p>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011417085.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011417306.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011417526.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>å†æ¬¡åˆ›å»ºå¯¹è±¡ï¼Œè‹¥æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­åˆæ»¡äº†ï¼Œåˆ™ä¼š<strong>å†æ¬¡è§¦å‘ Minor GC</strong>ï¼ˆä¼šè§¦å‘ <strong>stop the world</strong>ï¼Œ æš‚åœå…¶ä»–ç”¨æˆ·çº¿ç¨‹ï¼Œåªè®©åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œï¼‰ï¼Œè¿™æ—¶ä¸ä»…ä¼šå›æ”¶ä¼Šç”¸å›­ä¸­çš„åƒåœ¾ï¼Œ<strong>è¿˜ä¼šå›æ”¶å¹¸å­˜åŒºä¸­çš„åƒåœ¾</strong>ï¼Œå†å°†æ´»è·ƒå¯¹è±¡å¤åˆ¶åˆ°å¹¸å­˜åŒºTOä¸­ã€‚å›æ”¶ä»¥åä¼šäº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒºï¼Œå¹¶è®©å¹¸å­˜åŒºä¸­çš„å¯¹è±¡<strong>å¯¿å‘½åŠ 1</strong></p>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011417003.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>å¦‚æœå¹¸å­˜åŒºä¸­çš„å¯¹è±¡çš„<strong>å¯¿å‘½è¶…è¿‡æŸä¸ªé˜ˆå€¼</strong>ï¼ˆæœ€å¤§ä¸º15ï¼Œ4bitï¼‰ï¼Œå°±ä¼šè¢«<strong>æ”¾å…¥è€å¹´ä»£</strong>ä¸­</p>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011418090.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>å¦‚æœæ–°ç”Ÿä»£è€å¹´ä»£ä¸­çš„å†…å­˜éƒ½æ»¡äº†ï¼Œå°±ä¼šå…ˆè§¦å‘Minor GCï¼Œå†è§¦å‘<strong>Full GC</strong>ï¼Œæ‰«æ<strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸­</strong>æ‰€æœ‰ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¹¶å›æ”¶</p>
<h4 id="3-2-GC-åˆ†æ"><a href="#3-2-GC-åˆ†æ" class="headerlink" title="3.2 GC åˆ†æ"></a>3.2 GC åˆ†æ</h4><h5 id="3-2-1-GCç›¸å…³å‚æ•°"><a href="#3-2-1-GCç›¸å…³å‚æ•°" class="headerlink" title="3.2.1 GCç›¸å…³å‚æ•°"></a>3.2.1 GCç›¸å…³å‚æ•°</h5><table>
<thead>
<tr>
<th align="center">å«ä¹‰</th>
<th align="left">å‚æ•°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">å †åˆå§‹å¤§å°</td>
<td align="left">-Xms</td>
</tr>
<tr>
<td align="center">å †æœ€å¤§å¤§å°</td>
<td align="left">-Xmx æˆ– -XX:MaxHeapSize=size</td>
</tr>
<tr>
<td align="center">æ–°ç”Ÿä»£å¤§å°</td>
<td align="left">-Xmn æˆ– -XX:NewSize=size + -XX:MaxNewSize=size</td>
</tr>
<tr>
<td align="center">å¹¸å­˜åŒºæ¯”ä¾‹ï¼ˆåŠ¨æ€ï¼‰</td>
<td align="left">-XX:initialSurvivorRation=ratio æˆ– -XX:+UseAdaptiveSizePolicy</td>
</tr>
<tr>
<td align="center">å¹¸å­˜åŒºæ¯”ä¾‹</td>
<td align="left">-XX:SurvivorRatio=ratio</td>
</tr>
<tr>
<td align="center">æ™‹å‡é˜ˆå€¼</td>
<td align="left">-XX:MaxTenuringThreshold=threshold</td>
</tr>
<tr>
<td align="center">æ™‹å‡è¯¦æƒ…</td>
<td align="left">-XX:+PrintTenuringDistribution</td>
</tr>
<tr>
<td align="center">GCè¯¦æƒ…</td>
<td align="left">-XX:+PrintGCDetails -verbose:gc</td>
</tr>
<tr>
<td align="center">FullGCå‰MinorGC</td>
<td align="left">-XX:+ScavengeBeforeFullGC</td>
</tr>
</tbody></table>
<h5 id="3-2-2-å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"><a href="#3-2-2-å¤§å¯¹è±¡å¤„ç†ç­–ç•¥" class="headerlink" title="3.2.2 å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"></a>3.2.2 å¤§å¯¹è±¡å¤„ç†ç­–ç•¥</h5><p>å½“é‡åˆ°ä¸€ä¸ª<strong>è¾ƒå¤§çš„å¯¹è±¡</strong>æ—¶ï¼Œå°±ç®—æ–°ç”Ÿä»£çš„<strong>ä¼Šç”¸å›­</strong>ä¸ºç©ºï¼Œä¹Ÿ<strong>æ— æ³•å®¹çº³è¯¥å¯¹è±¡</strong>æ—¶ï¼Œä¼šå°†è¯¥å¯¹è±¡<strong>ç›´æ¥æ™‹å‡ä¸ºè€å¹´ä»£</strong></p>
<h5 id="3-2-3-çº¿ç¨‹å†…å­˜æº¢å‡º"><a href="#3-2-3-çº¿ç¨‹å†…å­˜æº¢å‡º" class="headerlink" title="3.2.3 çº¿ç¨‹å†…å­˜æº¢å‡º"></a>3.2.3 çº¿ç¨‹å†…å­˜æº¢å‡º</h5><p>æŸä¸ªçº¿ç¨‹çš„å†…å­˜æº¢å‡ºäº†è€ŒæŠ›å¼‚å¸¸ï¼ˆout of memoryï¼‰ï¼Œä¸ä¼šè®©å…¶ä»–çš„çº¿ç¨‹ç»“æŸè¿è¡Œ</p>
<p>è¿™æ˜¯å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹<strong>æŠ›å‡ºOOMå¼‚å¸¸å</strong>ï¼Œ<strong>å®ƒæ‰€å æ®çš„å†…å­˜èµ„æºä¼šå…¨éƒ¨è¢«é‡Šæ”¾æ‰</strong>ï¼Œä»è€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œï¼Œ<strong>è¿›ç¨‹ä¾ç„¶æ­£å¸¸</strong></p>
<h3 id="4-åƒåœ¾å›æ”¶å™¨"><a href="#4-åƒåœ¾å›æ”¶å™¨" class="headerlink" title="4. åƒåœ¾å›æ”¶å™¨"></a>4. åƒåœ¾å›æ”¶å™¨</h3><h4 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h4><p><strong>å¹¶è¡Œæ”¶é›†</strong>ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶<strong>ç”¨æˆ·çº¿ç¨‹ä»å¤„äºç­‰å¾…çŠ¶æ€</strong>ã€‚</p>
<p><strong>å¹¶å‘æ”¶é›†</strong>ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹<strong>åŒæ—¶å·¥ä½œ</strong>ï¼ˆä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„å¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ã€‚<strong>ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œ</strong>ï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºè¿è¡Œåœ¨å¦ä¸€ä¸ªCPUä¸Š</p>
<p><strong>ååé‡</strong>ï¼šå³CPUç”¨äº<strong>è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´</strong>ä¸CPU<strong>æ€»æ¶ˆè€—æ—¶é—´</strong>çš„æ¯”å€¼ï¼ˆååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / ( è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´ )ï¼‰ï¼Œä¹Ÿå°±æ˜¯ã€‚ä¾‹å¦‚ï¼šè™šæ‹Ÿæœºå…±è¿è¡Œ100åˆ†é’Ÿï¼Œåƒåœ¾æ”¶é›†å™¨èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ä¹ˆååé‡å°±æ˜¯99%</p>
<h4 id="4-1-ä¸²è¡Œ"><a href="#4-1-ä¸²è¡Œ" class="headerlink" title="4.1 ä¸²è¡Œ"></a>4.1 ä¸²è¡Œ</h4><ul>
<li>å•çº¿ç¨‹</li>
<li>å†…å­˜è¾ƒå°ï¼Œä¸ªäººç”µè„‘ï¼ˆCPUæ ¸æ•°è¾ƒå°‘ï¼‰</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011418507.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p><strong>å®‰å…¨ç‚¹</strong>ï¼šè®©å…¶ä»–çº¿ç¨‹éƒ½åœ¨è¿™ä¸ªç‚¹åœä¸‹æ¥ï¼Œä»¥å…åƒåœ¾å›æ”¶æ—¶ç§»åŠ¨å¯¹è±¡åœ°å€ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ‰¾ä¸åˆ°è¢«ç§»åŠ¨çš„å¯¹è±¡</p>
<p>å› ä¸ºæ˜¯ä¸²è¡Œçš„ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶çº¿ç¨‹ã€‚ä¸”åœ¨è¯¥çº¿ç¨‹æ‰§è¡Œå›æ”¶å·¥ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥<strong>é˜»å¡</strong>çŠ¶æ€</p>
<h5 id="4-1-1-Serial-æ”¶é›†å™¨"><a href="#4-1-1-Serial-æ”¶é›†å™¨" class="headerlink" title="4.1.1 Serial æ”¶é›†å™¨"></a>4.1.1 Serial æ”¶é›†å™¨</h5><p>Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬çš„ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong>å•çº¿ç¨‹ã€ç®€å•é«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼Œé‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€‚å¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ‰‹æœºæ•ˆç‡ã€‚æ”¶é›†å™¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒç»“æŸï¼ˆStop The Worldï¼‰</p>
<h5 id="4-1-2-ParNew-æ”¶é›†å™¨"><a href="#4-1-2-ParNew-æ”¶é›†å™¨" class="headerlink" title="4.1.2 ParNew æ”¶é›†å™¨"></a>4.1.2 ParNew æ”¶é›†å™¨</h5><p>ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ã€ParNewæ”¶é›†å™¨é»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œåœ¨CPUéå¸¸å¤šçš„ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨-XX:ParallelGCThreadså‚æ•°æ¥é™åˆ¶åƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ã€‚å’ŒSerialæ”¶é›†å™¨ä¸€æ ·å­˜åœ¨Stop The Worldé—®é¢˜</p>
<h5 id="4-1-3-Serial-Old-æ”¶é›†å™¨"><a href="#4-1-3-Serial-Old-æ”¶é›†å™¨" class="headerlink" title="4.1.3 Serial Old æ”¶é›†å™¨"></a>4.1.3 Serial Old æ”¶é›†å™¨</h5><p>Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šåŒæ ·æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong></p>
<h4 id="4-2-ååé‡ä¼˜å…ˆ"><a href="#4-2-ååé‡ä¼˜å…ˆ" class="headerlink" title="4.2 ååé‡ä¼˜å…ˆ"></a>4.2 ååé‡ä¼˜å…ˆ</h4><ul>
<li>å¤šçº¿ç¨‹</li>
<li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li>
<li><strong>å•ä½æ—¶é—´å†…</strong>ï¼ŒSTWï¼ˆstop the worldï¼Œåœæ‰å…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼‰æ—¶é—´æœ€çŸ­</li>
<li><strong>JDK1.8é»˜è®¤ä½¿ç”¨</strong>çš„åƒåœ¾å›æ”¶å™¨</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011418365.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="4-2-1-Parallel-Scavenge-æ”¶é›†å™¨"><a href="#4-2-1-Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="4.2.1 Parallel Scavenge æ”¶é›†å™¨"></a>4.2.1 Parallel Scavenge æ”¶é›†å™¨</h5><p>ä¸ååé‡å…³ç³»å¯†åˆ‡ï¼Œæ•…ä¹Ÿç§°ä¸ºååé‡ä¼˜å…ˆæ”¶é›†å™¨</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šå±äºæ–°ç”Ÿä»£æ”¶é›†å™¨ä¹Ÿæ˜¯é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>çš„æ”¶é›†å™¨ï¼ˆç”¨åˆ°äº†æ–°ç”Ÿä»£çš„å¹¸å­˜åŒºï¼‰ï¼Œåˆæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼ˆä¸ParNewæ”¶é›†å™¨ç±»ä¼¼ï¼‰</p>
<p>è¯¥æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ã€‚è¿˜æœ‰ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„ç‚¹æ˜¯ï¼š<strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼ˆä¸ParNewæ”¶é›†å™¨æœ€é‡è¦çš„ä¸€ä¸ªåŒºåˆ«ï¼‰</p>
<p><strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼šParallel Scavengeæ”¶é›†å™¨å¯è®¾ç½®-XX:+UseAdptiveSizePolicyå‚æ•°ã€‚å½“å¼€å…³æ‰“å¼€æ—¶<strong>ä¸éœ€è¦</strong>æ‰‹åŠ¨æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRationï¼‰ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è®¾ç½®è¿™äº›å‚æ•°ä»¥æä¾›æœ€ä¼˜çš„åœé¡¿æ—¶é—´å’Œæœ€é«˜çš„ååé‡ï¼Œè¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºGCçš„è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚</p>
<p>Parallel Scavengeæ”¶é›†å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ§åˆ¶ååé‡ï¼š</p>
<ul>
<li>XX:MaxGCPauseMillis æ§åˆ¶æœ€å¤§çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´</li>
<li>XX:GCRatio ç›´æ¥è®¾ç½®ååé‡çš„å¤§å°</li>
</ul>
<h5 id="4-2-2-Parallel-Old-æ”¶é›†å™¨"><a href="#4-2-2-Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="4.2.2 Parallel Old æ”¶é›†å™¨"></a>4.2.2 Parallel Old æ”¶é›†å™¨</h5><p>æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼ˆè€å¹´ä»£æ²¡æœ‰å¹¸å­˜åŒºï¼‰</p>
<h4 id="4-3-å“åº”æ—¶é—´ä¼˜å…ˆ"><a href="#4-3-å“åº”æ—¶é—´ä¼˜å…ˆ" class="headerlink" title="4.3 å“åº”æ—¶é—´ä¼˜å…ˆ"></a>4.3 å“åº”æ—¶é—´ä¼˜å…ˆ</h4><ul>
<li>å¤šçº¿ç¨‹</li>
<li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li>
<li>å°½å¯èƒ½è®©å•æ¬¡STWæ—¶é—´å˜çŸ­ï¼ˆå°½é‡ä¸å½±å“å…¶ä»–çº¿ç¨‹è¿è¡Œï¼‰</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011420094.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="4-3-1-CMS-æ”¶é›†å™¨"><a href="#4-3-1-CMS-æ”¶é›†å™¨" class="headerlink" title="4.3.1 CMS æ”¶é›†å™¨"></a>4.3.1 CMS æ”¶é›†å™¨</h5><p>Concurrent Mark Sweepï¼Œä¸€ç§ä»¥è·å–<strong>æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´</strong>ä¸ºç›®æ ‡çš„<strong>è€å¹´ä»£</strong>æ”¶é›†å™¨</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šåŸºäº<strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>å®ç°ã€‚å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæ³¨é‡æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒç­‰åœºæ™¯ä¸‹ã€‚å¦‚webç¨‹åºã€b/sæœåŠ¡</p>
<p><strong>CMSæ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‹åˆ—4æ­¥ï¼š</strong></p>
<p><strong>åˆå§‹æ ‡è®°</strong>ï¼šæ ‡è®°GC Rootsèƒ½ç›´æ¥åˆ°çš„å¯¹è±¡ã€‚é€Ÿåº¦å¾ˆå¿«ä½†æ˜¯<strong>ä»å­˜åœ¨Stop The Worldé—®é¢˜</strong></p>
<p><strong>å¹¶å‘æ ‡è®°</strong>ï¼šè¿›è¡ŒGC Roots Tracing çš„è¿‡ç¨‹ï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ä¸”ç”¨æˆ·çº¿ç¨‹å¯å¹¶å‘æ‰§è¡Œ</p>
<p><strong>é‡æ–°æ ‡è®°</strong>ï¼šä¸ºäº†<strong>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´</strong>å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚ä»ç„¶å­˜åœ¨Stop The World é—®é¢˜</p>
<p><strong>å¹¶å‘æ¸…é™¤</strong>ï¼šå¯¹æ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤å›æ”¶</p>
<p>CMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·<strong>å¹¶å‘æ‰§è¡Œ</strong>çš„</p>
<h4 id="4-4-G1"><a href="#4-4-G1" class="headerlink" title="4.4 G1"></a>4.4 G1</h4><p>Garbage First</p>
<p>JDK 9ä»¥åé»˜è®¤ä½¿ç”¨ï¼Œè€Œä¸”<strong>æ›¿ä»£äº†CMS æ”¶é›†å™¨</strong></p>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011419253.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="4-4-1-é€‚ç”¨åœºæ™¯"><a href="#4-4-1-é€‚ç”¨åœºæ™¯" class="headerlink" title="4.4.1 é€‚ç”¨åœºæ™¯"></a>4.4.1 é€‚ç”¨åœºæ™¯</h5><ul>
<li>åŒæ—¶æ³¨é‡ååé‡å’Œä½å»¶è¿Ÿï¼ˆå“åº”æ—¶é—´ï¼‰</li>
<li>è¶…å¤§å †å†…å­˜ï¼ˆå†…å­˜å¤§çš„ï¼‰ï¼Œä¼šå°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ª<strong>å¤§å°ç›¸ç­‰</strong>çš„åŒºåŸŸ</li>
<li>æ•´ä½“ä¸Šæ˜¯<strong>æ ‡è®°-æ•´ç†</strong>ç®—æ³•ï¼Œä¸¤ä¸ªåŒºåŸŸä¹‹é—´æ˜¯<strong>å¤åˆ¶</strong>ç®—æ³•</li>
</ul>
<p><strong>ç›¸å…³å‚æ•°</strong>ï¼šJDK8 å¹¶ä¸æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€éœ€è¦å‚æ•°å¼€å¯</p>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011419767.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="4-4-2-G1åƒåœ¾å›æ”¶é˜¶æ®µ"><a href="#4-4-2-G1åƒåœ¾å›æ”¶é˜¶æ®µ" class="headerlink" title="4.4.2 G1åƒåœ¾å›æ”¶é˜¶æ®µ"></a>4.4.2 G1åƒåœ¾å›æ”¶é˜¶æ®µ</h5><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151109.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶â€”â€“&gt;å†…å­˜ä¸è¶³ï¼Œæ–°ç”Ÿä»£å›æ”¶+å¹¶å‘æ ‡è®°â€”â€“&gt;å›æ”¶æ–°ç”Ÿä»£ä¼Šç”¸å›­ã€å¹¸å­˜åŒºã€è€å¹´ä»£å†…å­˜â€”â€”&gt;æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶(é‡æ–°å¼€å§‹)</p>
<h6 id="4-4-2-1-Young-Collection"><a href="#4-4-2-1-Young-Collection" class="headerlink" title="4.4.2.1 Young Collection"></a>4.4.2.1 Young Collection</h6><p><strong>åˆ†åŒºç®—æ³•region</strong></p>
<p>åˆ†ä»£æ˜¯æŒ‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼Œåˆ†åŒºåˆ™æ˜¯å°†å †ç©ºé—´åˆ’åˆ†è¿ç»­å‡ ä¸ªä¸åŒå°åŒºé—´ï¼Œæ¯ä¸€ä¸ªå°åŒºé—´ç‹¬ç«‹å›æ”¶ï¼Œå¯ä»¥æ§åˆ¶ä¸€æ¬¡å›æ”¶å¤šå°‘ä¸ªå°åŒºé—´ï¼Œæ–¹ä¾¿æ§åˆ¶ GC äº§ç”Ÿçš„åœé¡¿æ—¶é—´</p>
<p>Eï¼šä¼Šç”¸å›­ Sï¼šå¹¸å­˜åŒº Oï¼šè€å¹´ä»£</p>
<ul>
<li>ä¼šSTW</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011420416.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011421899.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011421653.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h6 id="4-4-2-2-Young-Collection-CM"><a href="#4-4-2-2-Young-Collection-CM" class="headerlink" title="4.4.2.2 Young Collection + CM"></a>4.4.2.2 Young Collection + CM</h6><p>CMï¼šå¹¶å‘æ ‡è®°</p>
<ul>
<li>åœ¨ Young GC æ—¶ä¼š<strong>å¯¹ GC Root è¿›è¡Œåˆå§‹æ ‡è®°</strong></li>
<li>åœ¨è€å¹´ä»£<strong>å ç”¨å †å†…å­˜çš„æ¯”ä¾‹</strong>è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå¯¹è¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆä¸ä¼šSTWï¼‰ï¼Œé˜ˆå€¼å¯ä»¥æ ¹æ®ç”¨æˆ·æ¥è¿›è¡Œè®¾å®š</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011421182.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h6 id="4-2-2-3-Mixed-Collection"><a href="#4-2-2-3-Mixed-Collection" class="headerlink" title="4.2.2.3 Mixed Collection"></a>4.2.2.3 Mixed Collection</h6><p>ä¼šå¯¹ E S O è¿›è¡Œ<strong>å…¨é¢çš„å›æ”¶</strong></p>
<ul>
<li>æœ€ç»ˆæ ‡è®°</li>
<li><strong>æ‹·è´</strong>å­˜æ´»</li>
</ul>
<p><code>-XX:MaxGCPauseMills:xxx</code> ç”¨äºæŒ‡å®šæœ€é•¿çš„åœé¡¿æ—¶é—´</p>
<p><strong>é—®</strong>ï¼šä¸ºä»€ä¹ˆæœ‰çš„è€å¹´ä»£è¢«æ‹·è´äº†ï¼Œæœ‰çš„æ²¡æ‹·è´ï¼Ÿ</p>
<p>å› ä¸ºæŒ‡å®šäº†æœ€å¤§åœé¡¿æ—¶é—´ï¼Œå¦‚æœå¯¹æ‰€æœ‰è€å¹´ä»£éƒ½è¿›è¡Œå›æ”¶ï¼Œè€—æ—¶å¯èƒ½è¿‡é«˜ã€‚ä¸ºäº†ä¿è¯æ—¶é—´ä¸è¶…è¿‡è®¾å®šçš„åœé¡¿æ—¶é—´ï¼Œä¼š<strong>å›æ”¶æœ€æœ‰ä»·å€¼çš„è€å¹´ä»£</strong>ï¼ˆå›æ”¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ›´å¤šå†…å­˜ï¼‰</p>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011422556.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="4-4-3-Full-GC"><a href="#4-4-3-Full-GC" class="headerlink" title="4.4.3 Full GC"></a>4.4.3 Full GC</h5><p><strong>å¯¹æ¯”</strong></p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>SerialGC<br><span class="hljs-bullet">-- </span>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc<br><span class="hljs-bullet">-- </span>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - full gc<br><br><span class="hljs-bullet">- </span>ParallelGC<br><span class="hljs-bullet">-- </span>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc<br><span class="hljs-bullet">-- </span>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - full gc<br><br><span class="hljs-bullet">- </span>CMS<br><span class="hljs-bullet">-- </span>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc<br><span class="hljs-bullet">-- </span>è€å¹´ä»£å†…å­˜ä¸è¶³<br><br><span class="hljs-bullet">- </span>G1<br><span class="hljs-bullet">-- </span>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc<br><span class="hljs-bullet">-- </span>è€å¹´ä»£å†…å­˜ä¸è¶³<br></code></pre></td></tr></table></figure>

<p>G1åœ¨è€å¹´ä»£å†…å­˜ä¸è¶³æ—¶ï¼ˆè€å¹´ä»£æ‰€å å†…å­˜è¶…è¿‡é˜ˆå€¼ï¼‰</p>
<ul>
<li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦æ…¢äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¸ä¼šè§¦å‘Full GCï¼Œè¿˜æ˜¯å¹¶å‘åœ°è¿›è¡Œæ¸…ç†</li>
<li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦å¿«äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¾¿ä¼šè§¦å‘Full GC</li>
</ul>
<h5 id="4-4-4-Young-Collection-è·¨ä»£å¼•ç”¨"><a href="#4-4-4-Young-Collection-è·¨ä»£å¼•ç”¨" class="headerlink" title="4.4.4 Young Collection è·¨ä»£å¼•ç”¨"></a>4.4.4 Young Collection è·¨ä»£å¼•ç”¨</h5><ul>
<li>æ–°ç”Ÿä»£å›æ”¶çš„è·¨ä»£å¼•ç”¨ï¼ˆè€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£ï¼‰é—®é¢˜</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011422185.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<ul>
<li>å¡è¡¨ä¸Remembered Set<ul>
<li>Remembered Set å­˜åœ¨äºEä¸­ï¼Œç”¨äºä¿å­˜æ–°ç”Ÿä»£å¯¹è±¡å¯¹åº”çš„è„å¡<ul>
<li>è„å¡ï¼šOè¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼ˆä¸€ä¸ªåŒºåŸŸ512Kï¼‰ï¼Œå¦‚æœè¯¥åŒºåŸŸå¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼Œåˆ™è¯¥åŒºåŸŸè¢«ç§°ä¸ºè„å¡</li>
</ul>
</li>
</ul>
</li>
<li>åœ¨å¼•ç”¨å˜æ›´æ—¶é€šè¿‡ post-write barried + dirty card queue</li>
<li>concurrent refinement threads æ›´æ–° Remembered Set</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011422519.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="4-4-5-Remark"><a href="#4-4-5-Remark" class="headerlink" title="4.4.5 Remark"></a>4.4.5 Remark</h5><p><strong>é‡æ–°æ ‡è®°é˜¶æ®µ</strong></p>
<p>åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ”¶é›†å™¨å¤„ç†å¯¹è±¡çš„è¿‡ç¨‹ä¸­</p>
<ul>
<li>é»‘è‰²ï¼šå·²è¢«å¤„ç†ï¼Œéœ€è¦ä¿ç•™çš„ </li>
<li>ç°è‰²ï¼šæ­£åœ¨å¤„ç†ä¸­çš„</li>
<li>ç™½è‰²ï¼šè¿˜æœªå¤„ç†çš„</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011423927.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>ä½†æ˜¯åœ¨<strong>å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­</strong>ï¼Œæœ‰å¯èƒ½Aè¢«å¤„ç†äº†ä»¥åæœªå¼•ç”¨Cï¼Œä½†è¯¥å¤„ç†è¿‡ç¨‹è¿˜æœªç»“æŸï¼Œåœ¨å¤„ç†è¿‡ç¨‹ç»“æŸä¹‹å‰Aå¼•ç”¨äº†Cï¼Œè¿™æ—¶å°±ä¼šç”¨åˆ°remark</p>
<p>è¿‡ç¨‹å¦‚ä¸‹</p>
<ul>
<li>ä¹‹å‰Cæœªè¢«å¼•ç”¨ï¼Œè¿™æ—¶Aå¼•ç”¨äº†Cï¼Œå°±ä¼šç»™CåŠ ä¸€ä¸ªå†™å±éšœï¼Œå†™å±éšœçš„æŒ‡ä»¤ä¼šè¢«æ‰§è¡Œï¼Œå°†Cæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­ï¼Œå¹¶å°†Cå˜ä¸º å¤„ç†ä¸­ çŠ¶æ€</li>
<li>åœ¨<strong>å¹¶å‘æ ‡è®°</strong>é˜¶æ®µç»“æŸä»¥åï¼Œé‡æ–°æ ‡è®°é˜¶æ®µä¼šSTWï¼Œç„¶åå°†æ”¾åœ¨è¯¥é˜Ÿåˆ—ä¸­çš„å¯¹è±¡é‡æ–°å¤„ç†ï¼Œå‘ç°æœ‰å¼ºå¼•ç”¨å¼•ç”¨å®ƒï¼Œå°±ä¼šå¤„ç†å®ƒ</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011423121.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="4-4-6-JDK-8u20-å­—ç¬¦ä¸²å»é‡"><a href="#4-4-6-JDK-8u20-å­—ç¬¦ä¸²å»é‡" class="headerlink" title="4.4.6 JDK 8u20 å­—ç¬¦ä¸²å»é‡"></a>4.4.6 JDK 8u20 å­—ç¬¦ä¸²å»é‡</h5><p>é»˜è®¤å¼€å¯ <code>-XX:+UseStringDeduplication</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">String s1 = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;hello&quot;</span>); <span class="hljs-comment">// char[]&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;&#125;</span><br>String s2 = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;hello&quot;</span>); <span class="hljs-comment">// char[]&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;&#125;</span><br></code></pre></td></tr></table></figure>

<p>è¿‡ç¨‹</p>
<ul>
<li>å°†æ‰€æœ‰æ–°åˆ†é…çš„å­—ç¬¦ä¸²ï¼ˆåº•å±‚æ˜¯char[]ï¼‰æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—</li>
<li>å½“æ–°ç”Ÿä»£å›æ”¶æ—¶ï¼ŒG1å¹¶å‘æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„å­—ç¬¦ä¸²</li>
<li>å¦‚æœå­—ç¬¦ä¸²çš„å€¼ä¸€æ ·ï¼Œå°±è®©ä»–ä»¬<strong>å¼•ç”¨åŒä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</strong></li>
<li>æ³¨æ„ï¼Œå…¶ä¸ String.intern çš„åŒºåˆ«<ul>
<li>internå…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ï¼ŒStringTable(ä¸²æ± )</li>
<li>å­—ç¬¦ä¸²å»é‡å…³æ³¨çš„æ˜¯char[]</li>
<li>åœ¨JVMå†…éƒ¨ï¼Œä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦ä¸²æ ‡</li>
</ul>
</li>
</ul>
<p>ä¼˜ç‚¹ä¸ç¼ºç‚¹</p>
<ul>
<li>èŠ‚çœäº†å¤§é‡å†…å­˜</li>
<li>æ–°ç”Ÿä»£å›æ”¶æ—¶é—´ç•¥å¾®å¢åŠ ï¼Œå¯¼è‡´ç•¥å¾®å¤šå ç”¨CPU</li>
</ul>
<h5 id="4-4-7-JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½"><a href="#4-4-7-JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½" class="headerlink" title="4.4.7 JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½"></a>4.4.7 JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½</h5><p>é»˜è®¤å¼€å¯ <code>-XX:+ClassUnloadingWithConcurrentMark</code></p>
<p>åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸä»¥åï¼Œå°±èƒ½çŸ¥é“å“ªäº›ç±»ä¸å†è¢«ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨çš„æ‰€æœ‰ç±»éƒ½ä¸åœ¨ä½¿ç”¨ï¼Œåˆ™å¸è½½å®ƒæ‰€åŠ è½½çš„æ‰€æœ‰ç±»</p>
<h5 id="4-4-8-JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡"><a href="#4-4-8-JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡" class="headerlink" title="4.4.8 JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡"></a>4.4.8 JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡</h5><ul>
<li>ä¸€ä¸ªå¯¹è±¡å¤§äºregionçš„ä¸€åŠæ—¶ï¼Œå°±ç§°ä¸ºå·¨å‹å¯¹è±¡</li>
<li>G1ä¸ä¼šå¯¹å·¨å‹å¯¹è±¡è¿›è¡Œæ‹·è´</li>
<li>å›æ”¶æ—¶è¢«ä¼˜å…ˆè€ƒè™‘</li>
<li>G1ä¼šè·Ÿè¸ªè€å¹´ä»£æ‰€æœ‰incomingå¼•ç”¨ï¼Œå¦‚æœè€å¹´ä»£incomingå¼•ç”¨ä¸º0çš„å·¨å‹å¯¹è±¡å°±å¯ä»¥åœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶å¤„ç†æ‰</li>
</ul>
<img src="https://tsuiraku.oss-cn-chengdu.aliyuncs.com/typora/202207011423889.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="4-4-9-JDK-9å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´"><a href="#4-4-9-JDK-9å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´" class="headerlink" title="4.4.9 JDK 9å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´"></a>4.4.9 JDK 9å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´</h5><ul>
<li>å¹¶å‘æ ‡è®°å¿…é¡»åœ¨å¯¹å †ç©ºé—´å æ»¡å‰å®Œæˆï¼Œå¦åˆ™é€€åŒ–ä¸ºFULLGC</li>
</ul>
<h3 id="5-GC-è°ƒä¼˜"><a href="#5-GC-è°ƒä¼˜" class="headerlink" title="5.GC è°ƒä¼˜"></a>5.GC è°ƒä¼˜</h3><p>æŸ¥çœ‹è™šæ‹Ÿæœºå‚æ•°å‘½ä»¤</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">JAVA<span class="hljs-regexp">/JDK8.0/</span>bin/java -XX:+PrintFlagsFinal -version | findstr <span class="hljs-string">&quot;GC&quot;</span><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure>

<p>å¯ä»¥æ ¹æ®å‚æ•°å»æŸ¥è¯¢å…·ä½“çš„ä¿¡æ¯</p>
<h4 id="5-1-è°ƒä¼˜é¢†åŸŸ"><a href="#5-1-è°ƒä¼˜é¢†åŸŸ" class="headerlink" title="5.1 è°ƒä¼˜é¢†åŸŸ"></a>5.1 è°ƒä¼˜é¢†åŸŸ</h4><ul>
<li>å†…å­˜</li>
<li>é”ç«äº‰</li>
<li>CPUå ç”¨</li>
<li>IO</li>
<li>GC</li>
</ul>
<h4 id="5-2-ç¡®å®šç›®æ ‡"><a href="#5-2-ç¡®å®šç›®æ ‡" class="headerlink" title="5.2 ç¡®å®šç›®æ ‡"></a>5.2 ç¡®å®šç›®æ ‡</h4><p>ä½å»¶è¿Ÿ or é«˜ååé‡ï¼Ÿ é€‰æ‹©åˆé€‚çš„GC</p>
<ul>
<li>CMS G1 ZGCï¼ˆä½å»¶è¿Ÿï¼‰</li>
<li>ParallelGCï¼ˆé«˜ååé‡ï¼‰</li>
<li>Zingï¼ˆä½å»¶è¿Ÿï¼‰</li>
</ul>
<h4 id="5-3-æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"><a href="#5-3-æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC" class="headerlink" title="5.3 æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"></a>5.3 æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC</h4><p>é¦–å…ˆæ’é™¤å‡å°‘å› ä¸ºè‡ªèº«ç¼–å†™çš„ä»£ç è€Œå¼•å‘çš„å†…å­˜é—®é¢˜</p>
<ul>
<li>æŸ¥çœ‹Full GCå‰åçš„å†…å­˜å ç”¨ï¼Œè€ƒè™‘ä»¥ä¸‹å‡ ä¸ªé—®é¢˜<ul>
<li>åŠ è½½çš„å†…å­˜æ•°æ®å¤ªå¤šï¼Ÿ</li>
<li>æ•°æ®è¡¨ç¤ºæ˜¯å¦å¤ªè‡ƒè‚¿<ul>
<li>å¯¹è±¡å›¾</li>
<li>å¯¹è±¡å¤§å°</li>
</ul>
</li>
<li>æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼</li>
</ul>
</li>
</ul>
<h4 id="5-4-æ–°ç”Ÿä»£è°ƒä¼˜"><a href="#5-4-æ–°ç”Ÿä»£è°ƒä¼˜" class="headerlink" title="5.4 æ–°ç”Ÿä»£è°ƒä¼˜"></a>5.4 æ–°ç”Ÿä»£è°ƒä¼˜</h4><ul>
<li>æ–°ç”Ÿä»£çš„ç‰¹ç‚¹<ul>
<li>æ‰€æœ‰çš„ new æ“ä½œåˆ†é…å†…å­˜éƒ½æ˜¯éå¸¸å»‰ä»·çš„<ul>
<li>TLABï¼ˆthread-local allocation bufferï¼‰</li>
</ul>
</li>
<li>æ­»äº¡å¯¹è±¡çš„å›æ”¶ä»£ä»·æ˜¯é›¶</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡ç”¨è¿‡å³æ­»ï¼ˆæœç”Ÿå¤•æ­»ï¼‰</li>
<li>MInor GC æ‰€ç”¨æ—¶é—´è¿œå°äº Full GC</li>
</ul>
</li>
<li>æ–°ç”Ÿä»£å†…å­˜è¶Šå¤§è¶Šå¥½ä¹ˆï¼Ÿ<code>-Xmn</code><ul>
<li>ä¸æ˜¯</li>
<li>å­˜åœ¨çš„é—®é¢˜<ul>
<li>æ–°ç”Ÿä»£å†…å­˜å¤ªå°ï¼šé¢‘ç¹è§¦å‘Minor GCï¼Œä¼šSTWï¼Œä¼šä½¿å¾—ååé‡ä¸‹é™</li>
<li>æ–°ç”Ÿä»£å†…å­˜å¤ªå¤§ï¼šè€å¹´ä»£å†…å­˜å æ¯”æœ‰æ‰€é™ä½ï¼Œä¼šæ›´é¢‘ç¹åœ°è§¦å‘Full GCã€‚è€Œä¸”è§¦å‘Minor GCæ—¶ï¼Œæ¸…ç†æ–°ç”Ÿä»£æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ›´é•¿</li>
<li>Oracleï¼š$25%heap\space size\lt generation\lt 50%heap\space size $</li>
</ul>
</li>
<li>æ–°ç”Ÿä»£å†…å­˜è®¾ç½®ä¸ºèƒ½å®¹çº³ <code>[å¹¶å‘é‡*(è¯·æ±‚-å“åº”)]</code> çš„æ•°æ®ä¸ºå®œ</li>
</ul>
</li>
</ul>
<h4 id="5-5-å¹¸å­˜åŒºè°ƒä¼˜"><a href="#5-5-å¹¸å­˜åŒºè°ƒä¼˜" class="headerlink" title="5.5 å¹¸å­˜åŒºè°ƒä¼˜"></a>5.5 å¹¸å­˜åŒºè°ƒä¼˜</h4><ul>
<li>å¹¸å­˜åŒºéœ€è¦èƒ½å¤Ÿä¿å­˜ <code>å½“å‰æ´»è·ƒå¯¹è±¡+éœ€è¦æ™‹å‡çš„å¯¹è±¡</code></li>
<li>æ™‹å‡é˜ˆå€¼é…ç½®å¾—å½“ï¼Œè®©é•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡å°½å¿«æ™‹å‡<ul>
<li><code>-XX:MaxTenuringThreshold=threshold</code></li>
<li>å¸Œæœ›è®©ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡é€šè¿‡ minor gc å›æ”¶ï¼Œè€Œä¸æ˜¯æ™‹å‡è‡³è€å¹´ä»£</li>
</ul>
</li>
</ul>
<h4 id="5-6-è€å¹´ä»£è°ƒä¼˜"><a href="#5-6-è€å¹´ä»£è°ƒä¼˜" class="headerlink" title="5.6 è€å¹´ä»£è°ƒä¼˜"></a>5.6 è€å¹´ä»£è°ƒä¼˜</h4><p>ä»¥ CMS ä¸ºä¾‹</p>
<ul>
<li>CMSçš„è€å¹´ä»£å†…å­˜è¶Šå¤§è¶Šå¥½</li>
<li>è€å¹´ä»£è°ƒä¼˜ä¹‹å‰å…ˆå°è¯•ä¸è¿›è¡Œè°ƒä¼˜<ul>
<li>ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè‹¥æ²¡æœ‰å‘ç”Ÿ FULL GCï¼Œè¯´æ˜è€å¹´ä»£çš„å†…å­˜å·²ç»è¶³å¤Ÿå¤§ï¼Œå°è¯•å…ˆè°ƒè¯•æ–°ç”Ÿä»£</li>
</ul>
</li>
<li>è§‚å¯Ÿå‘ç”Ÿ FULL GCçš„è€å¹´ä»£å†…å­˜å ç”¨ï¼Œè®²è€å¹´ä»£å†…å­˜é¢„è®¾è°ƒå¤§ $\frac{1}{4} \sim \frac{1}{3}$<ul>
<li><code>-XX:CMSInitaiatingOccupancyFraction=percent</code></li>
</ul>
</li>
</ul>
<h4 id="5-7-GCè°ƒä¼˜çš„æ¡ˆä¾‹"><a href="#5-7-GCè°ƒä¼˜çš„æ¡ˆä¾‹" class="headerlink" title="5.7 GCè°ƒä¼˜çš„æ¡ˆä¾‹"></a>5.7 GCè°ƒä¼˜çš„æ¡ˆä¾‹</h4><ul>
<li>æ¡ˆä¾‹1ï¼ŒFULL GC å’Œ Minor GC é¢‘ç¹<ul>
<li>å¢å¤§æ–°ç”Ÿä»£çš„å†…å­˜</li>
</ul>
</li>
<li>æ¡ˆä¾‹2ï¼Œè¯·æ±‚é«˜å³°æœŸå‘ç”Ÿ FULL GCï¼Œå•æ¬¡æš‚åœæ—¶é—´ç‰¹åˆ«é•¿ï¼ˆCMSï¼‰<ul>
<li>ä¸šåŠ¡éœ€è¦ä½å»¶è¿Ÿï¼Œå•æ¬¡æš‚åœæ—¶é—´ç‰¹åˆ«é•¿</li>
<li>å‘ç°æ˜¯é‡æ–°æ ‡è®°é˜¶æ®µæ—¶é—´è¿‡é•¿ï¼Œåœ¨é‡æ–°æ ‡è®°ä¹‹å‰å¯¹æ–°ç”Ÿä»£åšåƒåœ¾æ¸…ç† <code>-XX:+CMSScavengeBeforeRemark</code></li>
</ul>
</li>
<li>æ¡ˆä¾‹3ï¼Œè€å¹´ä»£å……è£•æƒ…å†µä¸‹ï¼Œå‘ç”Ÿ FULL GCï¼ˆJDK1.7ï¼‰<ul>
<li>æ–¹æ³•åŒºé‡‡ç”¨æ°¸ä¹…ä»£ï¼ˆéå…ƒç©ºé—´ï¼‰ï¼Œæ°¸ä¹…ä»£çš„ç©ºé—´ä¸è¶³</li>
</ul>
</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/categories/Java/Java%E8%AF%AD%E8%A8%80/">Javaè¯­è¨€</a>
                    
                      <a class="hover-with-bg" href="/categories/Java/Java%E8%AF%AD%E8%A8%80/JVM/">JVM</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/tags/JVM/">JVM</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼š <a target="_blank" href="https://tsuiraku.com/" rel="nofollow noopener noopener">tsuiraku</a>
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/08/17/spring/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Spring</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/10/10/springboot-springcache+redis/">
                        <span class="hidden-mobile">springbootæ•´åˆï¼šspringcache & redis</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"dC2NdQqyqOkPy2Xg2ij7PMS4-gzGzoHsz","appKey":"XMhtIUKKmpfGkgkdObosNu5I","placeholder":"ä¼˜è´¨è¯„è®ºå¯ä»¥å¸®åŠ©ä½œè€…è·å¾—æ›´é«˜æƒé‡ï¼ˆå¯ä»¥å¡«å†™æ‚¨çš„æ˜µç§°ä»¥åŠè”ç³»æ–¹å¼ï¼Œæ–¹ä¾¿ä½œè€…å›å¤ï¼‰","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"requiredFields":[]},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->



    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("10/01/2021 8:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²ç»è¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>

  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud ç»Ÿè®¡PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="leancloud-site-pv"></span>
             æ¬¡
          </span>
      
      
        <!-- LeanCloud ç»Ÿè®¡UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="leancloud-site-uv"></span>
             äºº
          </span>
      

    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  

  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


<!-- hexo injector body_end start --><script src="/js/backgroundize.js"></script>
  <link defer rel="stylesheet" href="/css/backgroundize.css" />
  
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?tsuirak";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="tsuirak";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/about/'){
                console.log('å·²æŒ‚è½½github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // æ— æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // æœ‰æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":300,"height":600},"mobile":{"show":false},"rect":"opacity:0.7","log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
